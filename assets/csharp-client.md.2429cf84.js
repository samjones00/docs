import{_ as t,c as e,o as p,b as n,e as s,a}from"./app.da189b1e.js";const I=`{"title":"C#/.NET Service Clients","description":"","frontmatter":{"slug":"csharp-client","title":"C#/.NET Service Clients"},"headers":[{"level":3,"title":"JsonApiClient","slug":"jsonapiclient"},{"level":3,"title":"HttpClient Factory Registration","slug":"httpclient-factory-registration"},{"level":3,"title":"Setup","slug":"setup"},{"level":3,"title":"Recommended ServiceClient for .NET 6+#","slug":"recommended-serviceclient-for-net-6"},{"level":3,"title":"Safe Sync HttpClient APIs","slug":"safe-sync-httpclient-apis"},{"level":2,"title":"High level Api and ApiAsync methods","slug":"high-level-api-and-apiasync-methods"},{"level":3,"title":"The ApiResult way","slug":"the-apiresult-way"},{"level":3,"title":"C# Example","slug":"c-example"},{"level":3,"title":"Available in all .NET and TypeScript Clients","slug":"available-in-all-net-and-typescript-clients"},{"level":2,"title":"REST API","slug":"rest-api"},{"level":3,"title":"Using the recommended API Design","slug":"using-the-recommended-api-design"},{"level":3,"title":"Alternative API","slug":"alternative-api"},{"level":2,"title":"Service Client API","slug":"service-client-api"},{"level":3,"title":"Using the recommended API Design","slug":"using-the-recommended-api-design-1"},{"level":3,"title":"Alternative API","slug":"alternative-api-1"},{"level":3,"title":"Cache Aware Service Clients","slug":"cache-aware-service-clients"},{"level":2,"title":"Support for Native built-in Response Types","slug":"support-for-native-built-in-response-types"},{"level":3,"title":"Accessing raw service responses","slug":"accessing-raw-service-responses"},{"level":3,"title":"Accessing client raw responses","slug":"accessing-client-raw-responses"},{"level":2,"title":"Sending Raw Data","slug":"sending-raw-data"},{"level":3,"title":"Sending Typed Request with Raw Body","slug":"sending-typed-request-with-raw-body"},{"level":2,"title":"Client / Server Request Compression","slug":"client-server-request-compression"},{"level":2,"title":"Authentication","slug":"authentication"},{"level":3,"title":"Sending Authenticate Request DTO","slug":"sending-authenticate-request-dto"},{"level":3,"title":"Request and Response Filters","slug":"request-and-response-filters"},{"level":3,"title":"Upload and Download Progress on Async API's","slug":"upload-and-download-progress-on-async-api-s"},{"level":3,"title":"Custom Client Caching Strategy","slug":"custom-client-caching-strategy"},{"level":3,"title":"Implicitly populate SessionId and Version Number","slug":"implicitly-populate-sessionid-and-version-number"},{"level":3,"title":"HTTP Verb Interface Markers","slug":"http-verb-interface-markers"},{"level":3,"title":"File Uploads","slug":"file-uploads"},{"level":3,"title":"Multiple File Uploads","slug":"multiple-file-uploads"},{"level":2,"title":"Capture HTTP Headers in .NET Service Clients","slug":"capture-http-headers-in-net-service-clients"},{"level":3,"title":"ServiceClient URL Resolvers","slug":"serviceclient-url-resolvers"},{"level":2,"title":"ServiceStack.Discovery.Consul","slug":"servicestack-discovery-consul"},{"level":2,"title":"Built-in Clients","slug":"built-in-clients"},{"level":3,"title":"JsonHttpClient","slug":"jsonhttpclient"},{"level":3,"title":"Xamarin Native HttpClient","slug":"xamarin-native-httpclient"},{"level":3,"title":"Differences with JsonServiceClient","slug":"differences-with-jsonserviceclient"},{"level":3,"title":"HttpWebRequest Service Clients","slug":"httpwebrequest-service-clients"}],"relativePath":"csharp-client.md","lastUpdated":1652174516790}`,o={},c=n("p",null,"Using DTOs to define your web service interface makes it possible to provide strong-typed generic service clients without any code-gen or extra build-steps, leading to a productive end-to-end type-safe communication gateway from client to server.",-1),l=n("iframe",{width:"896",height:"525",src:"https://www.youtube.com/embed/cbYuem1b2tg",frameborder:"0",allow:"autoplay; encrypted-media",allowfullscreen:""},null,-1),i=n("p",null,[n("strong",null,"ServiceStack.Client"),s(" is the primary NuGet package containing ServiceStack's client libraries that can be included in your "),n("code",null,".csproj"),s(" with:")],-1),u=n("div",{class:"nuget-copy cp flex cursor-pointer mb-3",onclick:"copy(this)"},[n("div",{class:"flex-grow bg-gray-700"},[n("div",{class:"pl-4 py-1 pb-1.5 align-middle text-lg text-white"},[n("p",null,[n("code",null,'<PackageReference Include="ServiceStack.Client" Version="6.*" />')])])]),n("div",{class:"flex"},[n("div",{class:"bg-sky-500 text-white p-1.5 pb-0"},[n("svg",{class:"copied w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})]),n("svg",{class:"nocopy w-6 h-6",title:"copy",fill:"none",stroke:"white",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})])])])],-1),r=n("p",null,[s("Earlier "),n("strong",null,".NET 6.0"),s(" can use the "),n("a",{href:"/csharp-client#jsonhttpclient"},"HttpClient-based JsonHttpClient"),s(" in:")],-1),k=n("div",{class:"nuget-copy cp flex cursor-pointer mb-3",onclick:"copy(this)"},[n("div",{class:"flex-grow bg-gray-700"},[n("div",{class:"pl-4 py-1 pb-1.5 align-middle text-lg text-white"},[n("p",null,[n("code",null,'<PackageReference Include="ServiceStack.HttpClient" Version="6.*" />')])])]),n("div",{class:"flex"},[n("div",{class:"bg-sky-500 text-white p-1.5 pb-0"},[n("svg",{class:"copied w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})]),n("svg",{class:"nocopy w-6 h-6",title:"copy",fill:"none",stroke:"white",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})])])])],-1),d=a(`<h3 id="jsonapiclient" tabindex="-1">JsonApiClient <a class="header-anchor" href="#jsonapiclient" aria-hidden="true">#</a></h3><p>From <strong>.NET 6+</strong> it&#39;s recommended to use the newest <a href="/releases/v6#jsonapiclient">JsonApiClient</a> released in v6+:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonApiClient</span><span class="token punctuation">(</span>baseUri<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="httpclient-factory-registration" tabindex="-1">HttpClient Factory Registration <a class="header-anchor" href="#httpclient-factory-registration" aria-hidden="true">#</a></h3><p>In client Apps that support it, the recommendation is to use a HttpClient Factory which can be done to register the <code>JsonApiClient</code> dependency in your App with:</p><div class="language-csharp"><pre><code>builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddJsonApiClient</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">[</span><span class="token string">&quot;BaseUrl&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>It&#39;s now recommended to use <code>JsonApiClient</code> when it&#39;s available, but for simplification the docs will continue to reference the substitutable &amp; more broadly available <code>JsonServiceClient</code>.</p><h4 id="blazor-client-registration" tabindex="-1">Blazor Client Registration <a class="header-anchor" href="#blazor-client-registration" aria-hidden="true">#</a></h4><p><strong>Blazor WASM</strong> should instead use the tailored <code>AddBlazorApiClient()</code> which also configures a CORS-enabled typed <code>JsonApiClient</code>:</p><div class="language-csharp"><pre><code>builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddBlazorApiClient</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">[</span><span class="token string">&quot;ApiBaseUrl&quot;</span><span class="token punctuation">]</span> <span class="token operator">??</span> builder<span class="token punctuation">.</span>HostEnvironment<span class="token punctuation">.</span>BaseAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="setup" tabindex="-1">Setup <a class="header-anchor" href="#setup" aria-hidden="true">#</a></h3><p>All ServiceStack&#39;s C# clients share the same interfaces and are created by passing in the <strong>Base URI</strong> of your ServiceStack service in the clients constructor, e.g. if your ServiceStack instance was hosted on the root path <code>/</code> on the <strong>5001</strong> custom port:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span><span class="token string">&quot;https://host:5001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or if hosted on the <code>/custom</code> custom path:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span><span class="token string">&quot;https://host/custom/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="recommended-serviceclient-for-net-6" tabindex="-1">Recommended ServiceClient for .NET 6+# <a class="header-anchor" href="#recommended-serviceclient-for-net-6" aria-hidden="true">#</a></h3><p>Going forward we&#39;ll continue improving <code>JsonApiClient</code> with new .NET runtime features and optimizations as they&#39;re available and now that .NET&#39;s <code>HttpWebRequest</code> has been officially <strong>deprecated in .NET 6+</strong> we recommend switching to use <code>JsonApiClient</code> in .NET 6+ runtimes.</p><h3 id="safe-sync-httpclient-apis" tabindex="-1">Safe Sync HttpClient APIs <a class="header-anchor" href="#safe-sync-httpclient-apis" aria-hidden="true">#</a></h3><p>Until adding <strong>net6.0</strong> TFM builds there was no officially supported way to perform synchronous requests with <code>HttpClient</code>, to implement the complete <code>IServiceClient</code> interface, <code>JsonHttpClient</code> had to adopt the least problematic sync-over-async solution.</p><p><code>JsonApiClient</code> improves its synchronous support by rewriting all Sync methods to use HttpClient&#39;s new blocking <code>Send()</code> method. Whilst Blocking I/O continues to impact scalability, it&#39;s nice to finally have an officially supported safe method to use free from deadlock concerns.</p><h2 id="high-level-api-and-apiasync-methods" tabindex="-1">High level <code>Api</code> and <code>ApiAsync</code> methods <a class="header-anchor" href="#high-level-api-and-apiasync-methods" aria-hidden="true">#</a></h2><p>.NET was originally conceived to use Exceptions for error control flow however there&#39;s been a tendency in modern languages &amp; libraries to shun Exceptions and return errors as normal values, an approach we believe is a more flexible &amp; ergonomic way to handle API responses.</p><h3 id="the-apiresult-way" tabindex="-1">The ApiResult way <a class="header-anchor" href="#the-apiresult-way" aria-hidden="true">#</a></h3><p>The new APIs simply returns a typed <code>ApiResult&lt;Response&gt;</code> Value Result that encapsulates either a Typed Response or a structured API Error populated in <code>ResponseStatus</code> allowing you to handle API responses programmatically without <code>try/catch</code> handling:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> api <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Api</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Hello</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>api<span class="token punctuation">.</span>Failed<span class="token punctuation">)</span> 
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Greeting failed! </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">api<span class="token punctuation">.</span>Error<span class="token punctuation">.</span>ErrorMessage</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">else</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;API Says: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">api<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>Result</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//api.Succeeded</span>
</code></pre></div><h3 id="c-example" tabindex="-1">C# Example <a class="header-anchor" href="#c-example" aria-hidden="true">#</a></h3><p>A preview of what this looks like is visible in <a href="/templates-blazor#api-and-apiasync-methods">Blazor WASMs Dev Model Preview</a> example code to create a new Booking:</p><div class="language-csharp"><pre><code><span class="token class-name">CreateBooking</span> request <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ApiResult<span class="token punctuation">&lt;</span>IdResponse<span class="token punctuation">&gt;</span></span> api <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">OnSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    api <span class="token operator">=</span> <span class="token keyword">await</span> Client<span class="token punctuation">.</span><span class="token function">ApiAsync</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>api<span class="token punctuation">.</span>Succeeded<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">await</span> done<span class="token punctuation">.</span><span class="token function">InvokeAsync</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span>Response<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Which despite its terseness handles both <strong>success</strong> and <strong>error</strong> API responses, <strong>if successful</strong> it invokes the <code>done()</code> callback notifying its parent of the new Booking API Response before resetting the Form&#39;s data model with a new Request DTO.</p><p>Upon <strong>failure</strong> the error response is populated in <code>api.Error</code> which binds to the UI via Blazor&#39;s <code>&lt;CascadingValue Value=@api.Error&gt;</code> to propagate it to all its child components in order to show contextual validation errors next to their respective Input controls.</p><h3 id="available-in-all-net-and-typescript-clients" tabindex="-1">Available in all .NET and TypeScript Clients <a class="header-anchor" href="#available-in-all-net-and-typescript-clients" aria-hidden="true">#</a></h3><p>The new <code>Api</code> and <code>ApiAsync</code> methods is available in all .NET Service Clients, including <a href="/service-gateway">Service Gateway&#39;s</a>.</p><h2 id="rest-api" tabindex="-1">REST API <a class="header-anchor" href="#rest-api" aria-hidden="true">#</a></h2><p>In addition, the Service Clients provide HTTP verbs (Get, Post &amp; PostFile, Put, Delete, Patch, etc) enabling a productive typed API for consuming ServiceStack Services with their best matching Custom Routes as seen in the examples below:</p><blockquote><p>See <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/IServiceClient.cs" target="_blank" rel="noopener noreferrer">IServiceClient</a> for the full API available</p></blockquote><h3 id="using-the-recommended-api-design" tabindex="-1">Using the recommended <a href="/api-design">API Design</a> <a class="header-anchor" href="#using-the-recommended-api-design" aria-hidden="true">#</a></h3><div class="language-csharp"><pre><code><span class="token class-name">HelloResponse</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Hello</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;World!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span>Result<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="async-example" tabindex="-1">Async Example <a class="header-anchor" href="#async-example" aria-hidden="true">#</a></h4><p>Using C# <code>await</code>:</p><div class="language-csharp"><pre><code><span class="token class-name">HelloResponse</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Hello</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;World!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="alternative-api" tabindex="-1">Alternative API <a class="header-anchor" href="#alternative-api" aria-hidden="true">#</a></h3><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>HelloResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;/hello/World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span>Result<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="async-example-1" tabindex="-1">Async Example <a class="header-anchor" href="#async-example-1" aria-hidden="true">#</a></h4><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>HelloResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;/hello/World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="service-client-api" tabindex="-1">Service Client API <a class="header-anchor" href="#service-client-api" aria-hidden="true">#</a></h2><p>C#/.NET Clients can call the above Hello Service using any of the JSON, JSV, XML or SOAP Service Clients with the code below:</p><h3 id="using-the-recommended-api-design-1" tabindex="-1">Using the recommended <a href="/api-design">API Design</a> <a class="header-anchor" href="#using-the-recommended-api-design-1" aria-hidden="true">#</a></h3><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Hello</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;World!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span>Result<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="async-example-2" tabindex="-1">Async Example <a class="header-anchor" href="#async-example-2" aria-hidden="true">#</a></h4><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">SendAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Hello</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;World!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span>Result<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="alternative-api-1" tabindex="-1">Alternative API <a class="header-anchor" href="#alternative-api-1" aria-hidden="true">#</a></h3><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Send</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>HelloResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Hello</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;World!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span>Result<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="async-example-3" tabindex="-1">Async Example <a class="header-anchor" href="#async-example-3" aria-hidden="true">#</a></h4><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">SendAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>HelloResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Hello</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;World!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The service clients use the automatic <a href="/endpoints">pre-defined routes</a> for each service.</p><p><a name="native-responses"></a></p><h3 id="cache-aware-service-clients" tabindex="-1"><a href="/cache-aware-clients">Cache Aware Service Clients</a> <a class="header-anchor" href="#cache-aware-service-clients" aria-hidden="true">#</a></h3><p>When <a href="/http-caching">caching is enabled on Services</a>, the Cache-aware Service Clients can dramatically improve performance by eliminating server requests entirely as well as reducing bandwidth for re-validated requests. They also offer an additional layer of resiliency as re-validated requests that result in Errors will transparently fallback to using pre-existing locally cached responses. For bandwidth-constrained environments like Mobile Apps they can dramatically improve the User Experience.</p><p>The Cache-Aware clients implement the full <code>IServiceClient</code> interface so they should be an easy drop-in enhancement for existing Apps:</p><div class="language-csharp"><pre><code><span class="token class-name">IServiceClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WithCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">//equivalent to:</span>
<span class="token class-name">IServiceClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CachedServiceClient</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Likewise for the HttpClient-based <code>JsonHttpClient</code>:</p><div class="language-csharp"><pre><code><span class="token class-name">IServiceClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonHttpClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WithCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">//equivalent to:</span>
<span class="token class-name">IServiceClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CachedHttpClient</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonHttpClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="support-for-native-built-in-response-types" tabindex="-1">Support for Native built-in Response Types <a class="header-anchor" href="#support-for-native-built-in-response-types" aria-hidden="true">#</a></h2><p>All of ServiceStack&#39;s generic Service Clients also allow you to fetch raw <code>string</code>, <code>byte[]</code> and <code>Stream</code> responses of any existing service, or when you need it, the underlying <code>HttpWebResponse</code> allowing fine-grained access to the HTTP Response. e.g With just the Service below:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/poco/{Text}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Poco</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>PocoResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Text <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PocoResponse</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Result <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NativeTypesExamples</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">PocoResponse</span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">Poco</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">AddHeader</span><span class="token punctuation">(</span><span class="token string">&quot;X-Response&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PocoResponse</span> <span class="token punctuation">{</span> 
            Result <span class="token operator">=</span> <span class="token string">&quot;Hello, &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>Text <span class="token operator">??</span> <span class="token string">&quot;World!&quot;</span><span class="token punctuation">)</span> 
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can access it normally with the typed API:</p><div class="language-csharp"><pre><code><span class="token class-name">PocoResponse</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Poco</span> <span class="token punctuation">{</span> Text <span class="token operator">=</span> <span class="token string">&quot;World&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span>Result <span class="token comment">//Hello, World</span>
</code></pre></div><p>Or as get the JSON as a raw string:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">string</span></span> responseJson <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;/poco/World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> dto <span class="token operator">=</span> responseJson<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">FromJson</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>PocoResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dto<span class="token punctuation">.</span>Result <span class="token comment">//Hello, World</span>
</code></pre></div><p>Or as raw bytes:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> responseBytes <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;/poco/World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> dto <span class="token operator">=</span> responseBytes<span class="token punctuation">.</span><span class="token function">FromUtf8Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">FromJson</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>PocoResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dto<span class="token punctuation">.</span>Result <span class="token comment">//Hello, World</span>
</code></pre></div><p>Or as a Stream:</p><div class="language-csharp"><pre><code><span class="token keyword">using</span> <span class="token class-name">Stream</span> responseStream <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Stream<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;/poco/World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> dto <span class="token operator">=</span> responseStream<span class="token punctuation">.</span><span class="token function">ReadFully</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">FromUtf8Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">FromJson</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>PocoResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dto<span class="token punctuation">.</span>Result <span class="token comment">//Hello, World</span>
</code></pre></div><p>Async download &amp; write to file example:</p><div class="language-csharp"><pre><code><span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> stream <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Stream<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">GetFile</span> <span class="token punctuation">{</span> Path <span class="token operator">=</span> <span class="token string">&quot;/path/to/file.png&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> fs <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>uploadsDir<span class="token punctuation">,</span> <span class="token string">&quot;file.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> stream<span class="token punctuation">.</span><span class="token function">CopyToAsync</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or even access the populated <code>HttpWebResponse</code> object:</p><div class="language-csharp"><pre><code><span class="token class-name">HttpWebResponse</span> webResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>HttpWebResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;/poco/World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

webResponse<span class="token punctuation">.</span>Headers<span class="token punctuation">[</span><span class="token string">&quot;X-Response&quot;</span><span class="token punctuation">]</span> <span class="token comment">//= World</span>

<span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> stream <span class="token operator">=</span> webResponse<span class="token punctuation">.</span><span class="token function">GetResponseStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> sr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StreamReader</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> dto <span class="token operator">=</span> sr<span class="token punctuation">.</span><span class="token function">ReadToEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">FromJson</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>PocoResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dto<span class="token punctuation">.</span>Result <span class="token comment">//Hello, World</span>
</code></pre></div><h3 id="accessing-raw-service-responses" tabindex="-1">Accessing raw service responses <a class="header-anchor" href="#accessing-raw-service-responses" aria-hidden="true">#</a></h3><p>ServiceStack isn&#39;t limited to just returning POCO&#39;s as you can effectively <a href="/service-return-types">return anything you want</a> even images <a href="http://test.servicestack.net/image-draw/ServiceStack?Width=600&amp;height=300&amp;Foreground=Yellow" target="_blank" rel="noopener noreferrer">/helloimage/ServiceStack?Width=600&amp;height=300&amp;Foreground=Yellow</a>. These native responses can also be mark on your Request DTO <code>IReturn&lt;T&gt;</code> interface marker to give you a terse end-to-end API for fetching raw responses, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/headers/{Text}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Headers</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>HttpWebResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Text <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/strings/{Text}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Strings</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Text <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/bytes/{Text}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Bytes</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Text <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/streams/{Text}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Streams</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>Stream<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Text <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BuiltInTypesService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">Headers</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">AddHeader</span><span class="token punctuation">(</span><span class="token string">&quot;X-Response&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">Strings</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Hello, &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>Text <span class="token operator">??</span> <span class="token string">&quot;World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Guid</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">Streams</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Guid</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>        
<span class="token punctuation">}</span>
</code></pre></div><h3 id="accessing-client-raw-responses" tabindex="-1">Accessing client raw responses <a class="header-anchor" href="#accessing-client-raw-responses" aria-hidden="true">#</a></h3><p>Which let you access the results as you would a normal response:</p><div class="language-csharp"><pre><code><span class="token keyword">using</span> <span class="token class-name">HttpWebResponse</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Headers</span> <span class="token punctuation">{</span> Text <span class="token operator">=</span> <span class="token string">&quot;World&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span>Headers<span class="token punctuation">[</span><span class="token string">&quot;X-Response&quot;</span><span class="token punctuation">]</span> <span class="token comment">// &quot;World&quot;</span>

<span class="token class-name"><span class="token keyword">string</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Strings</span> <span class="token punctuation">{</span> Text <span class="token operator">=</span> <span class="token string">&quot;World&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response <span class="token comment">// Hello, World</span>

<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Bytes</span> <span class="token punctuation">{</span> 
    Text <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> guid <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Guid</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token class-name">Stream</span> stream <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Streams</span> <span class="token punctuation">{</span> Text <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> guid <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Guid</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">ReadFully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>All these APIs are also available asynchronously as well:</p><div class="language-csharp"><pre><code><span class="token keyword">using</span> <span class="token class-name">HttpWebResponse</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Strings</span> <span class="token punctuation">{</span> Text <span class="token operator">=</span> <span class="token string">&quot;Test&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span>Headers<span class="token punctuation">[</span><span class="token string">&quot;X-Response&quot;</span><span class="token punctuation">]</span> <span class="token comment">// &quot;World&quot;</span>

<span class="token class-name"><span class="token keyword">string</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Strings</span> <span class="token punctuation">{</span> Text <span class="token operator">=</span> <span class="token string">&quot;World&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
response <span class="token comment">// Hello, World</span>

<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Bytes</span> <span class="token punctuation">{</span> 
    Text <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> guid <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Guid</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token class-name">Stream</span> stream <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Streams</span> <span class="token punctuation">{</span> 
    Text <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> guid <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Guid</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">ReadFully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>You must explicitly dispose all APIs returning either <code>HttpWebResponse</code> or <code>Stream</code> as seen in the above examples.</p></div><p>They all behave the same as the sync versions except for <code>HttpWebResponse</code> which gets returned just after the request is sent (asynchronously) and before any response is read so you can still access the HTTP Headers e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:2020/&quot;</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    ResponseFilter <span class="token operator">=</span> httpRes <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> header <span class="token operator">=</span> httpRes<span class="token punctuation">.</span>Headers<span class="token punctuation">[</span><span class="token string">&quot;X-Response&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Headers</span> <span class="token punctuation">{</span> Text <span class="token operator">=</span> <span class="token string">&quot;World&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Which makes a great starting point if you want to stream the responses back asynchronously as seen in this <a href="https://gist.github.com/bamboo/5078236" target="_blank" rel="noopener noreferrer">Reactive ServiceStack example</a> by <a href="https://twitter.com/rodrigobamboo" target="_blank" rel="noopener noreferrer">@rodrigobamboo</a>.</p><p>More examples can be found in the ServiceClients <a href="https://github.com/ServiceStack/ServiceStack/blob/master/tests/ServiceStack.WebHost.Endpoints.Tests/ServiceClientsBuiltInResponseTests.cs" target="_blank" rel="noopener noreferrer">Built-in native type response tests</a></p><h2 id="sending-raw-data" tabindex="-1">Sending Raw Data <a class="header-anchor" href="#sending-raw-data" aria-hidden="true">#</a></h2><p>.NET Service Clients can also send raw <code>string</code>, <code>byte[]</code> or <code>Stream</code> Request bodies in their custom Sync or Async API&#39;s, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">string</span></span> json <span class="token operator">=</span> <span class="token string">&quot;{\\&quot;Key\\&quot;:1}&quot;</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Post</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SendRawResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;/sendraw&quot;</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> bytes <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">ToUtf8Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Put</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SendRawResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;/sendraw&quot;</span><span class="token punctuation">,</span> bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Stream</span> stream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MemoryStream</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">PostAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SendRawResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;/sendraw&quot;</span><span class="token punctuation">,</span> stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="sending-typed-request-with-raw-body" tabindex="-1">Sending Typed Request with Raw Body <a class="header-anchor" href="#sending-typed-request-with-raw-body" aria-hidden="true">#</a></h3><p>The <code>*Body</code> and <code>*BodyAsync</code> APIs have avaialble in all Service Clients lets you post a separate Request Body for Request DTOs that implement <code>IRequiresRequestStream</code> where they contain both properties and a custom Request Body, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/json&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendJson</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IRequiresRequestStream</span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Stream</span> RequestStream <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/text&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendText</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IRequiresRequestStream</span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ContentType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Stream</span> RequestStream <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendRawService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">JsonOnly</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">SendJson</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> request<span class="token punctuation">.</span>RequestStream<span class="token punctuation">.</span><span class="token function">ReadFully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">SendText</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span>Request<span class="token punctuation">.</span>ResponseContentType <span class="token operator">=</span> request<span class="token punctuation">.</span>ContentType <span class="token operator">??</span> <span class="token keyword">base</span><span class="token punctuation">.</span>Request<span class="token punctuation">.</span>AcceptTypes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> request<span class="token punctuation">.</span>RequestStream<span class="token punctuation">.</span><span class="token function">ReadFully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The new APIs accept both a Request DTO which specifies which Service to call and what properties to add to the QueryString and another object to send in the raw HTTP Request Body, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>BaseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> json <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">PostBody</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SendJson</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;JSON body&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PocoRequest</span> <span class="token punctuation">{</span> Foo <span class="token operator">=</span> <span class="token string">&quot;Bar&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
json<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">FromJson</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>PocoRequest<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Foo <span class="token comment">//= Bar</span>

json <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">PutBodyAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SendJson</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;JSON body&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;{\\&quot;Foo\\&quot;:\\&quot;Bar\\&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
json<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">FromJson</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>PocoRequest<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Foo <span class="token comment">//= Bar</span>

<span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonHttpClient</span><span class="token punctuation">(</span>BaseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SendText</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;Text body&quot;</span><span class="token punctuation">,</span> ContentType <span class="token operator">=</span> <span class="token string">&quot;text/plain&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> text <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">PostBodyAsync</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
text <span class="token comment">//= foo</span>
</code></pre></div><h2 id="client-server-request-compression" tabindex="-1">Client / Server Request Compression <a class="header-anchor" href="#client-server-request-compression" aria-hidden="true">#</a></h2><p>You can elect to compress HTTP Requests in any C#/.NET Service Clients by specifying the Compression Type you wish to use, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    RequestCompressionType <span class="token operator">=</span> CompressionTypes<span class="token punctuation">.</span>GZip<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonHttpClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    RequestCompressionType <span class="token operator">=</span> CompressionTypes<span class="token punctuation">.</span>Deflate<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Request</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Where sending any HTTP Request containing a Request Body (e.g. POST/PUT) will send a compressed Request body to the Server where it&#39;s now able to be transparently decompressed and deserialized into your Request DTO.</p><h2 id="authentication" tabindex="-1">Authentication <a class="header-anchor" href="#authentication" aria-hidden="true">#</a></h2><p>ServiceStack&#39;s <a href="https://github.com/ServiceStack/ServiceStack/blob/master/tests/ServiceStack.WebHost.Endpoints.Tests/AuthTests.cs#L108" target="_blank" rel="noopener noreferrer">Auth Tests</a> shows different ways of authenticating when using the C# Service Clients. By default BasicAuth and DigestAuth is built into the clients, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUri<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    UserName <span class="token operator">=</span> UserName<span class="token punctuation">,</span>
    Password <span class="token operator">=</span> Password<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Send</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SecureResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>    
</code></pre></div><p>Behind the scenes ServiceStack will attempt to send the request normally but when the request is rejected and challenged by the Server the clients will automatically retry the same request but this time with the Basic/Digest Auth headers.</p><p>To skip the extra hop when you know you&#39;re accessing a secure service, you can tell the clients to always send the BasicAuth header with:</p><div class="language-csharp"><pre><code>client<span class="token punctuation">.</span>AlwaysSendBasicAuthHeader <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="sending-authenticate-request-dto" tabindex="-1">Sending Authenticate Request DTO <a class="header-anchor" href="#sending-authenticate-request-dto" aria-hidden="true">#</a></h3><p>The alternative way to Authenticate is to make an explicit call to the <code>Authenticate</code> service (this requires <code>CredentialsAuthProvider</code> enabled) e.g:</p><div class="language-csharp"><pre><code><span class="token class-name">AuthenticateResponse</span> authResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Authenticate</span> <span class="token punctuation">{</span>
    provider <span class="token operator">=</span> CredentialsAuthProvider<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> <span class="token comment">//= credentials</span>
    UserName <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span>
    Password <span class="token operator">=</span> <span class="token string">&quot;p@55word&quot;</span><span class="token punctuation">,</span>
    RememberMe <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                       <span class="token comment">//important tell client to retain permanent cookies</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Send</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SecureResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>    
</code></pre></div><p>After a successful call to the <code>Authenticate</code> service the client is Authenticated and if <strong>RememberMe</strong> is set, the client will retain the Session Cookies added by the Server on subsequent requests which is what enables future requests from that client to be authenticated.</p><h3 id="request-and-response-filters" tabindex="-1">Request and Response Filters <a class="header-anchor" href="#request-and-response-filters" aria-hidden="true">#</a></h3><p>When needing to execute custom logic before and after requests are sent and received you can use Global Request/Response Filters:</p><div class="language-csharp"><pre><code><span class="token comment">// Executed for all .NET HttpWebRequest ServiceClient instances like JsonServiceClient:</span>
ServiceClientBase<span class="token punctuation">.</span>GlobalRequestFilter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpWebRequest</span> req<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
ServiceClientBase<span class="token punctuation">.</span>GlobalResponseFilter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpWebResponse</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Executed for all JsonHttpClient instances</span>
JsonHttpClient<span class="token punctuation">.</span>GlobalRequestFilter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpRequestMessage</span> req<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
JsonHttpClient<span class="token punctuation">.</span>GlobalResponseFilter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpResponseMessage</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Or use instance Request/Response Filters if you only want to run custom logic for a specific instances:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    RequestFilter <span class="token operator">=</span> req <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ResponseFilter <span class="token operator">=</span> res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonHttpClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    RequestFilter <span class="token operator">=</span> req <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ResponseFilter <span class="token operator">=</span> res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="upload-and-download-progress-on-async-api-s" tabindex="-1">Upload and Download Progress on Async API&#39;s <a class="header-anchor" href="#upload-and-download-progress-on-async-api-s" aria-hidden="true">#</a></h3><p>The Async API&#39;s support on progress updates with the <code>OnDownloadProgress</code> and <code>OnUploadProgress</code> callbacks which can be used to provide UX Progress updates, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>ListeningOn<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Available in ASP.NET/HttpListener when downloading responses with known lengths </span>
<span class="token comment">//E.g: Strings, Files, etc.</span>
client<span class="token punctuation">.</span>OnDownloadProgress <span class="token operator">=</span> <span class="token punctuation">(</span>done<span class="token punctuation">,</span> total<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token string">&quot;{0}/{1} bytes downloaded&quot;</span><span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>done<span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>total = -1 when &#39;Transfer-Encoding: chunked&#39;</p></div><p>Whilst the <code>OnUploadProgress</code> callback gets fired when uploading files, e.g:</p><div class="language-csharp"><pre><code>client<span class="token punctuation">.</span>OnUploadProgress <span class="token operator">=</span> <span class="token punctuation">(</span>bytesWritten<span class="token punctuation">,</span> total<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    <span class="token string">&quot;Written {0}/{1} bytes...&quot;</span><span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>bytesWritten<span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">PostFileWithRequest</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UploadResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> 
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileInfo</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Upload</span> <span class="token punctuation">{</span> CreatedBy <span class="token operator">=</span> <span class="token string">&quot;Me&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="custom-client-caching-strategy" tabindex="-1">Custom Client Caching Strategy <a class="header-anchor" href="#custom-client-caching-strategy" aria-hidden="true">#</a></h3><p>The <code>ResultsFilter</code> and <code>ResultsFilterResponse</code> delegates on Service Clients can be used to enable a custom caching strategy.</p><p>Here&#39;s a basic example implementing a cache for all <strong>GET</strong> Requests:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span>ResultsFilter <span class="token operator">=</span> <span class="token punctuation">(</span>type<span class="token punctuation">,</span> method<span class="token punctuation">,</span> uri<span class="token punctuation">,</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">!=</span> HttpMethods<span class="token punctuation">.</span>Get<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">object</span></span> cachedResponse<span class="token punctuation">;</span>
    cache<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token keyword">out</span> cachedResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> cachedResponse<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span>ResultsFilterResponse <span class="token operator">=</span> <span class="token punctuation">(</span>webRes<span class="token punctuation">,</span> response<span class="token punctuation">,</span> method<span class="token punctuation">,</span> uri<span class="token punctuation">,</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">!=</span> HttpMethods<span class="token punctuation">.</span>Get<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    cache<span class="token punctuation">[</span>uri<span class="token punctuation">]</span> <span class="token operator">=</span> response<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//Subsequent requests returns cached result</span>
<span class="token class-name"><span class="token keyword">var</span></span> response1 <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">GetCustomer</span> <span class="token punctuation">{</span> CustomerId <span class="token operator">=</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> response2 <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">GetCustomer</span> <span class="token punctuation">{</span> CustomerId <span class="token operator">=</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//cached response</span>
</code></pre></div><p>The <code>ResultsFilter</code> delegate is executed with the context of the request before the request is made. Returning a value of type <code>TResponse</code> short-circuits the request and returns that response. Otherwise the request continues and its response passed into the <code>ResultsFilterResponse</code> delegate where it can be cached.</p><h3 id="implicitly-populate-sessionid-and-version-number" tabindex="-1">Implicitly populate SessionId and Version Number <a class="header-anchor" href="#implicitly-populate-sessionid-and-version-number" aria-hidden="true">#</a></h3><p>Service Clients can be used to auto-populate Request DTO&#39;s implementing <code>IHasSessionId</code> or <code>IHasVersion</code> by assigning the <code>Version</code> and <code>SessionId</code> properties on the Service Client, e.g:</p><div class="language-csharp"><pre><code>client<span class="token punctuation">.</span>Version <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span>SessionId <span class="token operator">=</span> authResponse<span class="token punctuation">.</span>SessionId<span class="token punctuation">;</span>
</code></pre></div><p>Which populates the SessionId and Version number on each Request DTO&#39;s that implementing the specific interfaces, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>HelloResponse<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IHasSessionId</span><span class="token punctuation">,</span> <span class="token class-name">IHasVersion</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Version <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> SessionId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Hello</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;World&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Auto populates Version and SessionId</span>
</code></pre></div><h3 id="http-verb-interface-markers" tabindex="-1">HTTP Verb Interface Markers <a class="header-anchor" href="#http-verb-interface-markers" aria-hidden="true">#</a></h3><p>You can decorate your Request DTO&#39;s using the <code>IGet</code>, <code>IPost</code>, <code>IPut</code>, <code>IDelete</code> and <code>IPatch</code> interface markers and the <code>Send</code> and <code>SendAsync</code> API&#39;s will use it to automatically send the Request using the selected HTTP Method. E.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloByGet</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IGet</span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>HelloResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloByPut</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IPut</span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>HelloResponse<span class="token punctuation">&gt;</span></span></span> 
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">HelloByGet</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;World&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//GET</span>

<span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">SendAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">HelloByPut</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;World&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//PUT</span>
</code></pre></div><p>Interface markers is supported in all .NET Service Clients, they&#39;re also included in the generated <a href="/add-servicestack-reference">Add ServiceStack Reference</a> DTO&#39;s so they&#39;re also available in the <a href="/java-add-servicestack-reference">Java JsonServiceClient</a> and <a href="/swift-add-servicestack-reference">Swift JsonServiceClient</a>. It&#39;s also available in our 3rd Party <a href="https://github.com/ServiceStack/Stripe" target="_blank" rel="noopener noreferrer">StripeGateway</a>.</p><p>Whilst a simple feature, it enables treating your remote services as a message-based API <a href="/advantages-of-message-based-web-services#advantages-of-message-based-designs">yielding its many inherent advantages</a> where your Application API&#39;s need only pass Request DTO models around to be able to invoke remote Services, decoupling the Service Request from its implementation which can be now easily managed by a high-level adapter that takes care of proxying the Request to the underlying Service Client. The adapter could also add high-level functionality of it&#39;s own including auto retrying of failed requests, generic error handling, logging/telemetrics, event notification, throttling, offline queuing/syncing, etc.</p><h3 id="file-uploads" tabindex="-1">File Uploads <a class="header-anchor" href="#file-uploads" aria-hidden="true">#</a></h3><p>You can use the <code>PostFile</code> API to upload a single File, with the Route of the Service you want to call, the name of the file and the <code>Stream</code> of its contents, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> fileStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileInfo</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">OpenRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> fileName <span class="token operator">=</span> <span class="token string">&quot;upload.html&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">PostFile</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>FileUploadResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;/files/upload&quot;</span><span class="token punctuation">,</span> 
    fileStream<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> MimeTypes<span class="token punctuation">.</span><span class="token function">GetMimeType</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Files uploaded using the <code>PostFile*</code> APIs are uploaded as a HTTP POST using the <code>multipart/form-data</code> Content-Type which can be accessed from the <code>IRequest.Files</code> collection in your Services, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/files/upload&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadFile</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadFileService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">string</span></span> UploadsDir <span class="token operator">=</span> <span class="token string">&quot;uploads&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Post</span><span class="token punctuation">(</span><span class="token class-name">UploadFile</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> uploadedFile <span class="token operator">=</span> <span class="token keyword">base</span><span class="token punctuation">.</span>Request<span class="token punctuation">.</span>Files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        VirtualFiles<span class="token punctuation">.</span><span class="token function">WriteFile</span><span class="token punctuation">(</span>UploadsDir<span class="token punctuation">.</span><span class="token function">CombineWith</span><span class="token punctuation">(</span>uploadedFile<span class="token punctuation">.</span>FileName<span class="token punctuation">)</span><span class="token punctuation">,</span> uploadedFile<span class="token punctuation">.</span>InputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileUploadResponse</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can use the <code>PostFileWithRequest</code> API To also include additional metadata with your File Upload, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DataContract</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/files/upload&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUpload</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>FileUploadResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DataMember</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> CustomerId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DataMember</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> CreatedDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonHttpClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> fileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileInfo</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> fileStream <span class="token operator">=</span> fileInfo<span class="token punctuation">.</span><span class="token function">OpenRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileUpload</span> <span class="token punctuation">{</span>
    CustomerId <span class="token operator">=</span> customerId<span class="token punctuation">,</span>
    CreatedDate <span class="token operator">=</span> fileInfo<span class="token punctuation">.</span>CreationTimeUtc<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">PostFileWithRequest</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>FileUploadResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
    <span class="token string">&quot;/files/upload&quot;</span><span class="token punctuation">,</span> fileStream<span class="token punctuation">,</span> fileInfo<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="multiple-file-uploads" tabindex="-1">Multiple File Uploads <a class="header-anchor" href="#multiple-file-uploads" aria-hidden="true">#</a></h3><p>The <code>PostFilesWithRequest</code> APIs available in all .NET Service Clients allow you to easily upload multiple streams within a single HTTP request. It supports populating Request DTO with any combination of QueryString and POST&#39;ed FormData in addition to multiple file upload data streams:</p><div class="language-csharp"><pre><code><span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> stream1 <span class="token operator">=</span> uploadFile1<span class="token punctuation">.</span><span class="token function">OpenRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> stream2 <span class="token operator">=</span> uploadFile2<span class="token punctuation">.</span><span class="token function">OpenRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">PostFilesWithRequest</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MultipleFileUploadResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
    <span class="token string">&quot;/multi-fileuploads?CustomerId=123&quot;</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MultipleFileUpload</span> <span class="token punctuation">{</span> CustomerName <span class="token operator">=</span> <span class="token string">&quot;Foo,Bar&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UploadFile</span><span class="token punctuation">(</span><span class="token string">&quot;upload1.png&quot;</span><span class="token punctuation">,</span> stream1<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UploadFile</span><span class="token punctuation">(</span><span class="token string">&quot;upload2.png&quot;</span><span class="token punctuation">,</span> stream2<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Example using only a Typed Request DTO. The <code>JsonHttpClient</code> also includes async equivalents for each of the <code>PostFilesWithRequest</code> APIs:</p><div class="language-csharp"><pre><code><span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> stream1 <span class="token operator">=</span> uploadFile1<span class="token punctuation">.</span><span class="token function">OpenRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> stream2 <span class="token operator">=</span> uploadFile2<span class="token punctuation">.</span><span class="token function">OpenRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonHttpClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">PostFilesWithRequestAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MultipleFileUploadResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MultipleFileUpload</span> <span class="token punctuation">{</span> CustomerId <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">,</span> CustomerName <span class="token operator">=</span> <span class="token string">&quot;Foo,Bar&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UploadFile</span><span class="token punctuation">(</span><span class="token string">&quot;upload1.png&quot;</span><span class="token punctuation">,</span> stream1<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UploadFile</span><span class="token punctuation">(</span><span class="token string">&quot;upload2.png&quot;</span><span class="token punctuation">,</span> stream2<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="capture-http-headers-in-net-service-clients" tabindex="-1">Capture HTTP Headers in .NET Service Clients <a class="header-anchor" href="#capture-http-headers-in-net-service-clients" aria-hidden="true">#</a></h2><p>A common issue when trying to diagnose service integration issues is wanting to inspect the full HTTP traffic to help identify issues. Inside .NET Applications this would typically require using an external packet sniffer like Fiddler but just like Post Command <strong>raw</strong> HTTP captured output above you can now capture the raw HTTP traffic of all .NET <code>*ServiceClient</code> with the new <code>CaptureHttp()</code> API.</p><p>To print HTTP requests to the Console use:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>BaseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">CaptureHttp</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">print</span><span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> authResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Authenticate</span> <span class="token punctuation">{</span> provider <span class="token operator">=</span> <span class="token string">&quot;credentials&quot;</span><span class="token punctuation">,</span> UserName <span class="token operator">=</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span> Password <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Which will print out the raw HTTP Request &amp; Response Headers and body to the Console, e.g:</p><div class="language-"><pre><code>POST /json/reply/Authenticate HTTP/1.1
Host: test.servicestack.net
Accept: application/json
User-Agent: ServiceStack .NET Client 5.121
Accept-Encoding: gzip,deflate
Content-Type: application/json

{&quot;provider&quot;:&quot;credentials&quot;,&quot;UserName&quot;:&quot;admin&quot;,&quot;Password&quot;:&quot;test&quot;}

HTTP/1.1 200 OK
Server: nginx/1.18.0, (Ubuntu)
Date: Sat, 21 Aug 2021 09:51:34 GMT
Transfer-Encoding: chunked
Connection: keep-alive
Set-Cookie: ss-id=o7VAdXm7JKLy92XiQcQQ; path=/; samesite=strict; httponly, ss-pid=I2MdbrzWZILqNCOqGlyR; expires=Wed, 21 Aug 2041 09:51:34 GMT; path=/; samesite=strict; httponly, ss-opt=temp; expires=Wed, 21 Aug 2041 09:51:34 GMT; path=/; samesite=strict; httponly, X-UAId=2; expires=Wed, 21 Aug 2041 09:51:34 GMT; path=/; samesite=strict; httponly, ss-tok=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsImtpZCI6IjNuLyJ9.eyJzdWIiOjIsImlhdCI6MTYyOTUzOTQ5NCwiZXhwIjoxNjMwNzQ5MDk0LCJlbWFpbCI6ImFkbWluQGdtYWlsLmNvbSIsImdpdmVuX25hbWUiOiJGaXJzdCBhZG1pbiIsImZhbWlseV9uYW1lIjoiTGFzdCBhZG1pbiIsIm5hbWUiOiJhZG1pbiBEaXNwbGF5TmFtZSIsInByZWZlcnJlZF91c2VybmFtZSI6ImFkbWluIiwicm9sZXMiOlsiQWRtaW4iXSwianRpIjoxMTR9.rHk-OdCwd8wR4AsT7exLRUr59-mzFs0FvKZUeZhvKMI; expires=Sat, 04 Sep 2021 09:51:34 GMT; path=/; samesite=strict; httponly, ss-reftok=eyJ0eXAiOiJKV1RSIiwiYWxnIjoiSFMyNTYiLCJraWQiOiIzbi8ifQ.eyJzdWIiOjIsImlhdCI6MTYyOTUzOTQ5NCwiZXhwIjoxNjYxMDc1NDk0LCJqdGkiOi02OX0.35MpYdz-QIkbVf98y_wNTA9PIYDy_EEQc3zfkpFvuQc; expires=Sun, 21 Aug 2022 09:51:34 GMT; path=/; samesite=strict; httponly
Vary: Accept
Access-Control-Allow-Credentials: true
Access-Control-Allow-Headers: Content-Type, Allow, Authorization, X-Args
Access-Control-Allow-Methods: GET, POST, PUT, DELETE, PATCH, OPTIONS, HEAD
X-Powered-By: ServiceStack/5.111 NetCore/Linux
X-Cookies: ss-tok,ss-reftok
Content-Type: application/json; charset=utf-8

{&quot;userId&quot;:&quot;2&quot;,&quot;sessionId&quot;:&quot;o7VAdXm7JKLy92XiQcQQ&quot;,&quot;userName&quot;:&quot;admin&quot;,&quot;displayName&quot;:&quot;admin DisplayName&quot;,&quot;bearerToken&quot;:&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsImtpZCI6IjNuLyJ9.eyJzdWIiOjIsImlhdCI6MTYyOTUzOTQ5NCwiZXhwIjoxNjMwNzQ5MDk0LCJlbWFpbCI6ImFkbWluQGdtYWlsLmNvbSIsImdpdmVuX25hbWUiOiJGaXJzdCBhZG1pbiIsImZhbWlseV9uYW1lIjoiTGFzdCBhZG1pbiIsIm5hbWUiOiJhZG1pbiBEaXNwbGF5TmFtZSIsInByZWZlcnJlZF91c2VybmFtZSI6ImFkbWluIiwicm9sZXMiOlsiQWRtaW4iXSwianRpIjoxMTR9.rHk-OdCwd8wR4AsT7exLRUr59-mzFs0FvKZUeZhvKMI&quot;,&quot;refreshToken&quot;:&quot;eyJ0eXAiOiJKV1RSIiwiYWxnIjoiSFMyNTYiLCJraWQiOiIzbi8ifQ.eyJzdWIiOjIsImlhdCI6MTYyOTUzOTQ5NCwiZXhwIjoxNjYxMDc1NDk0LCJqdGkiOi02OX0.35MpYdz-QIkbVf98y_wNTA9PIYDy_EEQc3zfkpFvuQc&quot;,&quot;profileUrl&quot;:&quot;data:image/svg+xml,...&quot;,&quot;roles&quot;:[&quot;Admin&quot;],&quot;permissions&quot;:[],&quot;responseStatus&quot;:{}}
</code></pre></div><p>Alternatively you can log it to the debug logger with:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>BaseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">CaptureHttp</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">log</span><span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or if preferred you can capture it in a <code>StringBuilder</code> to inspect later by disabling clearing it after each request:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>BaseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">CaptureHttp</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">clear</span><span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Which will begin capturing all HTTP requests made by that client in a <code>StringBuilder</code> you can access with:</p><div class="language-csharp"><pre><code>client<span class="token punctuation">.</span>HttpLog
</code></pre></div><h3 id="serviceclient-url-resolvers" tabindex="-1">ServiceClient URL Resolvers <a class="header-anchor" href="#serviceclient-url-resolvers" aria-hidden="true">#</a></h3><p>The urls used in all .NET Service Clients are now customizable with the new <code>UrlResolver</code> and <code>TypedUrlResolver</code> delegates.</p><p>E.g. you can use this feature to rewrite the URL used with the Request DTO Type Name used as the subdomain by:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> 
<span class="token keyword">class</span> <span class="token class-name">Request</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token function">JsonServiceClient</span><span class="token punctuation">(</span><span class="token string">&quot;http://example.org/api&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    TypedUrlResolver <span class="token operator">=</span>  <span class="token punctuation">(</span>meta<span class="token punctuation">,</span> httpMethod<span class="token punctuation">,</span> dto<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
        meta<span class="token punctuation">.</span>BaseUri<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">&quot;example.org&quot;</span><span class="token punctuation">,</span> dto<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Name <span class="token operator">+</span> <span class="token string">&quot;.example.org&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">CombineWith</span><span class="token punctuation">(</span>dto<span class="token punctuation">.</span><span class="token function">ToUrl</span><span class="token punctuation">(</span>httpMethod<span class="token punctuation">,</span> meta<span class="token punctuation">.</span>Format<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> res <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//= http://Request.example.org/api/test</span>
<span class="token class-name"><span class="token keyword">var</span></span> res <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//= http://Request.example.org/api/test</span>
</code></pre></div><p>This feature is also implemented in <code>JsonHttpClient</code>, examples below shows rewriting APIs that use custom urls:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token function">JsonHttpClient</span><span class="token punctuation">(</span><span class="token string">&quot;http://example.org/api&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    UrlResolver <span class="token operator">=</span> <span class="token punctuation">(</span>meta<span class="token punctuation">,</span> httpMethod<span class="token punctuation">,</span> url<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
        meta<span class="token punctuation">.</span>BaseUri<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">&quot;example.org&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;111.111.111.111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">CombineWith</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">DeleteAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MockResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;/dummy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//=http://111.111.111.111/api/dummy</span>

<span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">PutAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MockResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;/dummy&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//=http://111.111.111.111/api/dummy</span>
</code></pre></div><h2 id="servicestack-discovery-consul" tabindex="-1"><a href="https://github.com/wwwlicious/servicestack-discovery-consul" target="_blank" rel="noopener noreferrer">ServiceStack.Discovery.Consul</a> <a class="header-anchor" href="#servicestack-discovery-consul" aria-hidden="true">#</a></h2><p>This feature makes it easier to support features like <a href="https://github.com/wwwlicious/servicestack-discovery-consul" target="_blank" rel="noopener noreferrer">ServiceStack.Discovery.Consul</a> plugin which enables external RequestDTO endpoint discovery by integrating with <a href="http://consul.io" target="_blank" rel="noopener noreferrer">Consul.io</a> to provide automatic service registration and health checking.</p><h2 id="built-in-clients" tabindex="-1">Built-in Clients <a class="header-anchor" href="#built-in-clients" aria-hidden="true">#</a></h2><p>All REST and ServiceClients share the same interfaces (<code>IServiceClient</code>, <code>IRestClient</code> and <code>IRestClientAsync</code>) so they can easily be replaced (for increased perf/debuggability/etc) with a single line of code.</p><h3 id="jsonhttpclient" tabindex="-1">JsonHttpClient <a class="header-anchor" href="#jsonhttpclient" aria-hidden="true">#</a></h3><p>The new <code>JsonHttpClient</code> is an alternative to the existing generic typed <code>JsonServiceClient</code> for consuming ServiceStack Services which instead of using <strong>HttpWebRequest</strong> is based on Microsoft&#39;s latest async <a href="https://www.nuget.org/packages/Microsoft.Net.Http" target="_blank" rel="noopener noreferrer">HttpClient</a>.</p><p>JsonHttpClient implements the full <a href="https://gist.github.com/mythz/4683438240820b522d39" target="_blank" rel="noopener noreferrer">IServiceClient API</a> making it an easy drop-in replacement for your existing JsonServiceClient where in most cases it can simply be renamed to JsonHttpClient, e.g:</p><div class="language-csharp"><pre><code><span class="token comment">//IServiceClient client = new JsonServiceClient(&quot;https://techstacks.io&quot;);</span>
<span class="token class-name">IServiceClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonHttpClient</span><span class="token punctuation">(</span><span class="token string">&quot;https://techstacks.io&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">GetTechnology</span> <span class="token punctuation">{</span> Slug <span class="token operator">=</span> <span class="token string">&quot;servicestack&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>As .NET&#39;s HttpClient only supports async APIs it needs to use &quot;sync over async&quot; to implement sync APIs <strong>which should be avoided</strong>. If your API needs to make sync API calls it should use .NET 6&#39;s <code>JsonApiClient</code> or the <code>JsonServiceClient</code> instead.</p></div><h4 id="install" tabindex="-1">Install <a class="header-anchor" href="#install" aria-hidden="true">#</a></h4><p>JsonHttpClient can be downloaded from NuGet at:</p>`,179),h=n("div",{class:"nuget-copy cp flex cursor-pointer mb-3",onclick:"copy(this)"},[n("div",{class:"flex-grow bg-gray-700"},[n("div",{class:"pl-4 py-1 pb-1.5 align-middle text-lg text-white"},[n("p",null,[n("code",null,'<PackageReference Include="ServiceStack.HttpClient" Version="6.*" />')])])]),n("div",{class:"flex"},[n("div",{class:"bg-sky-500 text-white p-1.5 pb-0"},[n("svg",{class:"copied w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})]),n("svg",{class:"nocopy w-6 h-6",title:"copy",fill:"none",stroke:"white",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})])])])],-1),m=a(`<h3 id="xamarin-native-httpclient" tabindex="-1">Xamarin Native HttpClient <a class="header-anchor" href="#xamarin-native-httpclient" aria-hidden="true">#</a></h3><p>Using the default managed <code>HttpClient</code> implementation in Xamarin has a <a href="https://docs.microsoft.com/en-us/xamarin/cross-platform/macios/http-stack#cons-2" target="_blank" rel="noopener noreferrer">number of issues</a> in iOS and Android devices.</p><p>Xamarin&#39;s MSDN docs explain the advantages of native implementations and show how you can enable <a href="https://docs.microsoft.com/en-us/xamarin/cross-platform/macios/http-stack" target="_blank" rel="noopener noreferrer">native HttpClient implementation for iOS/macOS</a> for your project.</p><p>If you want to <a href="https://docs.microsoft.com/en-us/xamarin/cross-platform/macios/http-stack#programmatically-setting-the-httpmessagehandler" target="_blank" rel="noopener noreferrer">programmatically enable it for iOS/macOS</a>, you&#39;ll likely want to configure it once on the <code>GlobalHttpMessageHandlerFactory</code> for all <code>JsonHttpClient</code> instances to use, e.g:</p><div class="language-csharp"><pre><code><span class="token comment">// iOS</span>
JsonHttpClient<span class="token punctuation">.</span>GlobalHttpMessageHandlerFactory <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NSUrlSessionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or to only configure it for a specific client you can initialize an instance with:</p><div class="language-csharp"><pre><code><span class="token comment">// iOS</span>
<span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonHttpClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    HttpMessageHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NSUrlSessionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Refer to the <a href="https://docs.microsoft.com/en-us/xamarin/android/app-fundamentals/http-stack?tabs=windows" target="_blank" rel="noopener noreferrer">Xamarin MSDN docs for Android HttpClient</a> for how to enable it in your project, which can be globally programmatically configured with:</p><div class="language-csharp"><pre><code><span class="token comment">// Android</span>
JsonHttpClient<span class="token punctuation">.</span>GlobalHttpMessageHandlerFactory <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Xamarin<span class="token punctuation">.</span>Android<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>AndroidClientHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or per instance with:</p><div class="language-csharp"><pre><code><span class="token comment">// Android</span>
<span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonHttpClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    HttpMessageHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Xamarin<span class="token punctuation">.</span>Android<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>AndroidClientHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="differences-with-jsonserviceclient" tabindex="-1">Differences with JsonServiceClient <a class="header-anchor" href="#differences-with-jsonserviceclient" aria-hidden="true">#</a></h3><p>Whilst the goal is to retain the same behavior in both clients, there are some differences resulting from using HttpClient where the Global and Instance Request and Response Filters are instead passed HttpClients <code>HttpRequestMessage</code> and <code>HttpResponseMessage</code>.</p><p>Also, all API&#39;s are <strong>Async</strong> under-the-hood where any Sync API&#39;s that doesn&#39;t return a <code>Task&lt;T&gt;</code> just blocks on the Async <code>Task.Result</code> response. As this can dead-lock in certain environments we recommend sticking with the Async API&#39;s unless safe to do otherwise.</p><h3 id="httpwebrequest-service-clients" tabindex="-1">HttpWebRequest Service Clients <a class="header-anchor" href="#httpwebrequest-service-clients" aria-hidden="true">#</a></h3><p>Whilst the list below contain the built-in clients based on .NET&#39;s built-in <code>HttpWebRequest</code>:</p><ul><li>implements both <code>IRestClient</code> and <code>IServiceClient</code>: <ul><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Client/JsonServiceClient.cs" target="_blank" rel="noopener noreferrer">JsonServiceClient</a> (uses default endpoint with <strong>JSON</strong>) - recommended</li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Client/JsvServiceClient.cs" target="_blank" rel="noopener noreferrer">JsvServiceClient</a> (uses default endpoint with <strong>JSV</strong>)</li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Client/XmlServiceClient.cs" target="_blank" rel="noopener noreferrer">XmlServiceClient</a> (uses default endpoint with <strong>XML</strong>)</li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Client/CsvServiceClient.cs" target="_blank" rel="noopener noreferrer">CsvServiceClient</a> (uses default endpoint with <strong>CSV</strong>)</li><li><a href="/messagepack-format">MsgPackServiceClient</a> (uses default endpoint with <strong>Message-Pack</strong>)</li><li><a href="/protobuf-format">ProtoBufServiceClient</a> (uses default endpoint with <strong>Protocol Buffers</strong>)</li></ul></li><li>implements <code>IServiceClient</code> only: <ul><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Client/Soap11ServiceClient.cs" target="_blank" rel="noopener noreferrer">Soap11ServiceClient</a> (uses <strong>SOAP 11</strong> endpoint)</li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Client/Soap12ServiceClient.cs" target="_blank" rel="noopener noreferrer">Soap12ServiceClient</a> (uses <strong>SOAP 12</strong> endpoint)</li></ul></li></ul><h4 id="install-1" tabindex="-1">Install <a class="header-anchor" href="#install-1" aria-hidden="true">#</a></h4><p>The HttpWebRequest clients above are available in:</p>`,19),g=n("div",{class:"nuget-copy cp flex cursor-pointer mb-3",onclick:"copy(this)"},[n("div",{class:"flex-grow bg-gray-700"},[n("div",{class:"pl-4 py-1 pb-1.5 align-middle text-lg text-white"},[n("p",null,[n("code",null,'<PackageReference Include="ServiceStack.Client" Version="6.*" />')])])]),n("div",{class:"flex"},[n("div",{class:"bg-sky-500 text-white p-1.5 pb-0"},[n("svg",{class:"copied w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})]),n("svg",{class:"nocopy w-6 h-6",title:"copy",fill:"none",stroke:"white",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})])])])],-1),y=n("h1",{id:"community-resources",tabindex:"-1"},[s("Community Resources "),n("a",{class:"header-anchor",href:"#community-resources","aria-hidden":"true"},"#")],-1),w=n("ul",null,[n("li",null,[n("a",{href:"https://gist.github.com/bamboo/5078236",target:"_blank",rel:"noopener noreferrer"},"Reactive ServiceStack"),s(" by "),n("a",{href:"https://twitter.com/rodrigobamboo",target:"_blank",rel:"noopener noreferrer"},"@rodrigobamboo")])],-1),v=[c,l,i,u,r,k,d,h,m,g,y,w];function f(b,q,S,C,R,T){return p(),e("div",null,v)}var x=t(o,[["render",f]]);export{I as __pageData,x as default};
