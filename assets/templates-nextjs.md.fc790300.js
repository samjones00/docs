import{_ as t}from"./chunks/next-black.60b3e95b.js";import{_ as a,c as n,o as s,a as e,b as o}from"./app.877820b6.js";var r="/assets/jamstack-logo.ed938cc2.svg",i="/assets/nextjs-local-dev.cf9d62a6.svg",p="/assets/nextjs-hosted.445fa9f9.svg",c="/assets/gh-action-adhoc-workflow.dbcf135a.png";const _='{"title":"NextJS JAMStack Template","description":"","frontmatter":{"slug":"templates-nextjs","title":"NextJS JAMStack Template"},"headers":[{"level":2,"title":"NextJS and JAMStack","slug":"nextjs-and-jamstack"},{"level":2,"title":"NextJS and Edge Functions","slug":"nextjs-and-edge-functions"},{"level":2,"title":"Project Structure","slug":"project-structure"},{"level":2,"title":"UI project","slug":"ui-project"},{"level":2,"title":"API project","slug":"api-project"},{"level":2,"title":"Development vs Production","slug":"development-vs-production"},{"level":2,"title":"Deployment process","slug":"deployment-process"},{"level":3,"title":"Ways to deploy","slug":"ways-to-deploy"},{"level":2,"title":"Hosting","slug":"hosting"}],"relativePath":"templates-nextjs.md"}',l={},d=e('<div class="flex flex-wrap justify-center"><img src="'+t+'"><img src="'+r+'" style="display:block;"></div><p><a href="https://nextjs.org/" target="_blank" rel="noopener noreferrer">NextJS</a> is a framework built on top of <a href="https://reactjs.org/" target="_blank" rel="noopener noreferrer">React</a> that aims to solve a lot of the pain points related to rapidly developing a React application. NextJS takes care of setting up common patterns for development, and built-in features like <a href="https://nextjs.org/docs/routing/introduction" target="_blank" rel="noopener noreferrer">routing</a>, <a href="https://nextjs.org/docs/basic-features/built-in-css-support" target="_blank" rel="noopener noreferrer">CSS/Sass support</a>, <a href="https://nextjs.org/docs/basic-features/fast-refresh" target="_blank" rel="noopener noreferrer">Fast Refresh</a>, any many more, making it a very attractive way to build React applications.</p><h2 id="nextjs-and-jamstack" tabindex="-1">NextJS and JAMStack <a class="header-anchor" href="#nextjs-and-jamstack" aria-hidden="true">#</a></h2><p>NextJS enables the building of a static site through the use of the <a href="https://nextjs.org/docs/advanced-features/static-html-export" target="_blank" rel="noopener noreferrer"><code>next export</code></a> command. This allows us to host the generated static site anywhere we like and have a clean separation between the generated static site and a well-defined webservice API provided by ServiceStack. The <a href="https://jamstack.org/" target="_blank" rel="noopener noreferrer">JAMStack</a> pattern promotes this separation of JavaScript, API and Markup (JAM) as the architecture of websites and applications that deliver great performance but also flexibility. It is common to have content heavy sites, using statically generated <em>Markup</em>, that utilize modern frontend libraries and <em>JavaScript</em> combined with data from an <em>API</em> to make content compelling and interactive.</p><h2 id="nextjs-and-edge-functions" tabindex="-1">NextJS and Edge Functions <a class="header-anchor" href="#nextjs-and-edge-functions" aria-hidden="true">#</a></h2><p>NextJS creators, Vercel, also offer a way to host <a href="https://vercel.com/docs/concepts/functions/edge-functions" target="_blank" rel="noopener noreferrer"><em>Edge Functions</em></a> using JavaScript can integrate with their other hosting services. This provides a convenient and fast way to provide custom server functionality without worrying about the hosting.</p><p>However, as convenient as they are, these don&#39;t produce <a href="./why-servicestack">well-defined webservice APIs</a> for easy reuse outside your web application. This is where ServiceStack can offer a developer experience that will not only enable fast integration for your NextJS application, but for <a href="/add-servicestack-reference">any additional client applications in most languages and platforms</a>.</p>',7),u=o("iframe",{class:"video-hd",src:"https://www.youtube.com/embed/Vae0ALalIP0",frameborder:"0",allow:"autoplay; encrypted-media",allowfullscreen:""},null,-1),h=e('<h2 id="project-structure" tabindex="-1">Project Structure <a class="header-anchor" href="#project-structure" aria-hidden="true">#</a></h2><p>Following this JAMStack pattern, the <code>nextjs</code> template has a separate folder for the <code>ui</code> NextJS application, and the <code>api</code> ServiceStack application.</p><ul><li><code>.deploy</code> - Files used for built-in GitHub Actions deployment.</li><li><code>.github</code> - GitHub Actions workflows for deployment to GitHub Pages and a Linux server with <code>docker compose</code>.</li><li><code>ui</code> - NextJS application used to generate your static site.</li><li><code>api</code> - ServiceStack application hosting your well-defined web service APIs.</li><li><code>Dockerfile</code> - Dockerfile for your ServiceStack application.</li></ul><h2 id="ui-project" tabindex="-1">UI project <a class="header-anchor" href="#ui-project" aria-hidden="true">#</a></h2><p>The UI project is based off the NextJS <a href="https://github.com/vercel/next.js/tree/canary/examples/blog-starter-typescript" target="_blank" rel="noopener noreferrer">Blog Starter TypeScript</a> template, providing a familiar NextJS developer workflow. This project has support for statically generated pages from both Markdown files and TSX files.</p><p>This template has been extended with authentication coming from the ServiceStack <code>api</code> application enabled with the IdentityAuth provider and JWT. Admin, profile, sign-in and signup pages have been added with example integration to get you started.</p><p>This provides a pattern for content heavy Markdown in the <code>_posts</code> directory that perform well for SEO since they output static HTML pages.</p><p>Tailwind is also incorporated into this template as well, enabling you to take advantage of <a href="https://tailwindui.com/" target="_blank" rel="noopener noreferrer">Tailwind component providers</a> that can be dropped straight into your TSX pages.</p><h2 id="api-project" tabindex="-1">API project <a class="header-anchor" href="#api-project" aria-hidden="true">#</a></h2><p>The ServiceStack application is in the root <code>api</code> directory and by default will be hosted on <code>http://localhost:5000</code> for local development. The AppHost project has been configured with several features built-in to the template</p><ul><li>Auth - IdentityAuth + JWT</li><li>AuthRepository - Custom AppUser, EntityFramework with Identity roles</li><li>AppHost - CORS and SharpPages Plugins</li><li>Database - EntityFramework using SQLite</li></ul><h2 id="development-vs-production" tabindex="-1">Development vs Production <a class="header-anchor" href="#development-vs-production" aria-hidden="true">#</a></h2><p>During local development, the template utilizes <code>next.config.js</code> to handle rewrites from the localhost:3000 domain to our locally running ServiceStack API.</p><p><img src="'+i+`" alt=""></p><p>This allows us to use the ServiceStack API and the ServiceStack client to take advantage of typed end to end development, just like building any other client for a ServiceStack service. However, we can also leverage the <a href="https://swr.vercel.app/" target="_blank" rel="noopener noreferrer"><code>stale-while-revalidate</code></a> library built into the NextJS framework to apply conditional fetching and local cache.</p><div class="language-typescript"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> client <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../lib/gateway&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Hello <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../lib/dtos&#39;</span>
<span class="token keyword">import</span> useSWR <span class="token keyword">from</span> <span class="token string">&#39;swr&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">HelloApi</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token operator">:</span><span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> error <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useSWR</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Hello:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> key <span class="token operator">=&gt;</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;ml-2 text-red-500&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>error<span class="token punctuation">.</span>message<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;ml-3 text-2xl&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>data <span class="token operator">?</span> data<span class="token punctuation">.</span>result <span class="token operator">:</span> <span class="token string">&#39;loading...&#39;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Once deployed, the hosted statically generated site will call the API at the <code>PROD_API</code> configured address. If you are hosting across multiple domains, you will need to configure your ServiceStack application to support CORS for the domain where you host the output from the <code>ui</code> project.</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CorsFeature</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">allowOriginWhitelist</span><span class="token punctuation">:</span><span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span> 
    <span class="token string">&quot;https://localhost:5001&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;http://localhost:5000&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;http://localhost:3000&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;https://nextjs-gh.web-templates.io&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">allowCredentials</span><span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>By default, the GitHub Actions provided with the template will deploy to GitHub Pages. GitHub Pages can be configured using a <code>CNAME</code> file to use a custom domain. The above use of the <code>CorsFeature</code> plugin in <code>Configure.AppHost.cs</code> shows we are adding the <code>nextjs-gh.web-templates.io</code> domain to the <code>allowOriginWhitelist</code> so the server will accept requests from our GitHub Pages domain of <code>https://nextjs-gh.web-templates.io</code>.</p><p><img src="`+p+'" alt=""></p><h2 id="deployment-process" tabindex="-1">Deployment process <a class="header-anchor" href="#deployment-process" aria-hidden="true">#</a></h2><p>JAMStack deployments are extremely flexible since the UI and API are logically separated. They can be hosted together with the API also serving the statically generated site files, or using separate hosts with a variety of different setups.</p><p>This template utilizes <a href="https://github.com/features/actions" target="_blank" rel="noopener noreferrer">GitHub Actions</a> to support 2 different hosting setups. Deployed together in a Docker image, hosting the static site under <code>wwwroot</code>. Or separately on two different domains utilizing <a href="/corsfeature">CORS configuration</a> to communicate across domains. The UI project is hosted directly on <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a> while the API is bundled into a Docker image and can be hosted on any <a href="/do-github-action-mix-deployment">Linux server with SSH access and Docker Compose</a>.</p><p>To support both, the <code>npm publish</code> command copies the statically generated site and copies the output to the <code>wwwroot</code> folder within the API before it is bundled into a docker image. Additionally, the <code>release.yml</code> GitHub Actions workflow pushes the UI to the <code>gh-pages</code> branch of your repository to enable GitHub Pages deployment.</p><h3 id="ways-to-deploy" tabindex="-1">Ways to deploy <a class="header-anchor" href="#ways-to-deploy" aria-hidden="true">#</a></h3><p>By default, the template is configured to trigger a deployment on every push or Release to the GitHub repository. It can also be deployed manually providing the <em>tag</em> you want to redeploy.</p><p><img src="'+c+'" alt=""></p><p>This adhoc method can work with the default <code>latest</code> as well as any previous <em>tagged Releases</em> you have created. This provides a basic rollback mechanism. If you have been uses <code>Releases</code>to tag your application, you can specify a tag, eg <code>v2</code> and the GitHub Action will do the following.</p><ul><li>Checkout your code at the specified tag</li><li>Rebuild and deploy your <code>ui</code></li><li>Use the specified tag to change which version is running via <code>docker compose</code> on the remote server</li></ul><blockquote><p>By default, the remote server will assume the tagged Docker image exists and does not need to be rebuilt when using a specific tag for an adhoc release.</p></blockquote><blockquote><p>The provided GitHub Actions are just a starting point for how to deploy your application. When your hosting requirements change you&#39;ll need to update your GitHub Actions to suit.</p></blockquote><h2 id="hosting" tabindex="-1">Hosting <a class="header-anchor" href="#hosting" aria-hidden="true">#</a></h2><p>The template provides a <em>starting</em> point for hosting your ServiceStack application using a basic Linux host with Docker + <code>docker compose</code>. How your ServiceStack server is hosted will depend on your needs and requirements. For example, to avoid CORS a CDN provider could also rewrite requests to different origins which would also free up your API to be hosted anyway you need without paying the overhead for additional CORS related requests.</p>',33),k=[d,u,h];function g(f,m,y,v,w,b){return s(),n("div",null,k)}var A=a(l,[["render",g]]);export{_ as __pageData,A as default};
