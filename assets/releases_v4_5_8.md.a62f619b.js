import{_ as n,a as s,b as a,c as e,d as t,e as o,f as p,g as c,h as i}from"./chunks/8-created.67fd7241.js";import{_ as r}from"./chunks/startup-errors.a67f3dfa.js";import{_ as l,c as u,o as k,a as d}from"./app.877820b6.js";const x='{"title":"v4.5.8 Release Notes","description":"","frontmatter":{"title":"v4.5.8 Release Notes","slug":"v4-5-8"},"headers":[{"level":2,"title":"Open API","slug":"open-api"},{"level":3,"title":"Embedded Swagger UI","slug":"embedded-swagger-ui"},{"level":3,"title":"Azure API Management","slug":"azure-api-management"},{"level":3,"title":"AutoRest","slug":"autorest"},{"level":2,"title":"Expanding the Server Events Universe","slug":"expanding-the-server-events-universe"},{"level":3,"title":"Java Server Events","slug":"java-server-events"},{"level":3,"title":"Android Java Chat","slug":"android-java-chat"},{"level":3,"title":"Configuring the Server Events Client","slug":"configuring-the-server-events-client"},{"level":3,"title":"Integrated Facebook, Twitter and Google Logins","slug":"integrated-facebook-twitter-and-google-logins"},{"level":3,"title":"LoginButtonsActivity","slug":"loginbuttonsactivity"},{"level":3,"title":"Automatically Sign-In previously Signed In Users","slug":"automatically-sign-in-previously-signed-in-users"},{"level":2,"title":"TypeScript Server Events Client","slug":"typescript-server-events-client"},{"level":3,"title":"Built-in CSS Receiver","slug":"built-in-css-receiver"},{"level":2,"title":"Web, Node.js and React Native ServerEvents Apps","slug":"web-node-js-and-react-native-serverevents-apps"},{"level":3,"title":"Web App","slug":"web-app"},{"level":3,"title":"Node.js Server App","slug":"node-js-server-app"},{"level":3,"title":"React Native Mobile App","slug":"react-native-mobile-app"},{"level":3,"title":"Typed API calls in JavaScript","slug":"typed-api-calls-in-javascript"},{"level":3,"title":"Consuming ServiceStack Services in TypeScript or JavaScript projects","slug":"consuming-servicestack-services-in-typescript-or-javascript-projects"},{"level":2,"title":"C# Server Events Client","slug":"c-server-events-client"},{"level":3,"title":"Event Triggers","slug":"event-triggers"},{"level":3,"title":"StrictMode","slug":"strictmode"},{"level":3,"title":"Parameterless methods","slug":"parameterless-methods"},{"level":2,"title":"TypeScript @servicestack/client improvements","slug":"typescript-servicestack-client-improvements"},{"level":3,"title":"Sending additional arguments with Typed API Requests","slug":"sending-additional-arguments-with-typed-api-requests"},{"level":3,"title":"Calling APIs with Custom URLs","slug":"calling-apis-with-custom-urls"},{"level":2,"title":"Relaxed TypeScript Definitions","slug":"relaxed-typescript-definitions"},{"level":2,"title":"Authentication via OAuth AccessTokens","slug":"authentication-via-oauth-accesstokens"},{"level":3,"title":"Client Authentication with AccessToken","slug":"client-authentication-with-accesstoken"},{"level":2,"title":"JWT Refresh Tokens","slug":"jwt-refresh-tokens"},{"level":3,"title":"Accessing Refresh Tokens","slug":"accessing-refresh-tokens"},{"level":3,"title":"Lifetimes of tokens","slug":"lifetimes-of-tokens"},{"level":3,"title":"Using JWT and Refresh Tokens","slug":"using-jwt-and-refresh-tokens"},{"level":3,"title":"Handling Refresh Tokens Expiring","slug":"handling-refresh-tokens-expiring"},{"level":3,"title":"Using an alternative JWT Server","slug":"using-an-alternative-jwt-server"},{"level":3,"title":"Requires User Auth Repository","slug":"requires-user-auth-repository"},{"level":3,"title":"Validate Token Callbacks","slug":"validate-token-callbacks"},{"level":2,"title":"Fluent Validation Upgraded","slug":"fluent-validation-upgraded"},{"level":3,"title":"Async Validators","slug":"async-validators"},{"level":2,"title":"Async Global Request Filters","slug":"async-global-request-filters"},{"level":2,"title":"Enhanced Compression Options","slug":"enhanced-compression-options"},{"level":3,"title":"[CompressResponse] Attribute","slug":"compressresponse-attribute"},{"level":3,"title":"Static File Compression","slug":"static-file-compression"},{"level":2,"title":"Community","slug":"community"},{"level":3,"title":"ServiceStack.Logging.Serilog","slug":"servicestack-logging-serilog"},{"level":2,"title":"Community Projects","slug":"community-projects"},{"level":3,"title":"ServiceStack.Webhooks","slug":"servicestack-webhooks"},{"level":3,"title":"ServiceStack.Authentication.Azure","slug":"servicestack-authentication-azure"},{"level":3,"title":"ServiceStack.Authentication.Marten","slug":"servicestack-authentication-marten"},{"level":3,"title":"MultiAppSettingsBuilder","slug":"multiappsettingsbuilder"},{"level":3,"title":"CacheClient with Prefix","slug":"cacheclient-with-prefix"},{"level":2,"title":"OrmLite","slug":"ormlite"},{"level":3,"title":"OrmLite Soft Deletes","slug":"ormlite-soft-deletes"},{"level":3,"title":"Check Constraints","slug":"check-constraints"},{"level":2,"title":"ServiceStack.Text","slug":"servicestack-text"},{"level":2,"title":"Rabbit MQ","slug":"rabbit-mq"},{"level":2,"title":"Startup Errors","slug":"startup-errors"},{"level":3,"title":"Forcing a Content Type","slug":"forcing-a-content-type"},{"level":2,"title":"Minor Authentication Features","slug":"minor-authentication-features"},{"level":3,"title":"AuthFilterContext","slug":"authfiltercontext"},{"level":3,"title":"ICustomUserAuth","slug":"icustomuserauth"},{"level":3,"title":"AuthProvider available on IAuthSession","slug":"authprovider-available-on-iauthsession"},{"level":3,"title":"Customizable PopulateUserRoles on AspNetWindowsAuthProvider","slug":"customizable-populateuserroles-on-aspnetwindowsauthprovider"},{"level":2,"title":"All .NET Core Examples upgraded to .NET Core 1.1","slug":"all-net-core-examples-upgraded-to-net-core-1-1"},{"level":2,"title":"Other Changes","slug":"other-changes"}],"relativePath":"releases/v4_5_8.md"}',h={},g=d(`<p>We&#39;ve got a super mega release in store bursting with exciting new features across ServiceStack and its surrounding ecosystem with new support for the <a href="https://github.com/OAI/OpenAPI-Specification" target="_blank" rel="noopener noreferrer">Open API specification</a> enabling new integration possibilities with <a href="https://azure.microsoft.com/en-us/services/api-management/" target="_blank" rel="noopener noreferrer">Azure API Management</a> and <a href="https://github.com/Azure/autorest" target="_blank" rel="noopener noreferrer">Azure AutoRest</a>, our real-time <a href="/server-events">Server Events</a> solution extending to new Mobile, Desktop and Server platforms, more flexible Authentication options to dramatically simplify integration with Mobile, Desktop and Web clients, effortless JWT Refresh Tokens, enhanced support for TypeScript and Java client libraries, new compression options, upgrades to the latest Fluent Validation with support for Async validators, Async Request Filters, a number of new quality OSS ServiceStack projects developed by the community and lots more use-case driven features and refinements across the entire ServiceStack suite!</p><h2 id="open-api" tabindex="-1">Open API <a class="header-anchor" href="#open-api" aria-hidden="true">#</a></h2><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/openapi/openapi-banner.png" alt=""></p><p>We&#39;re thrilled to be able to ship another <a href="https://servicestack.uservoice.com/forums/176786-feature-requests/suggestions/9940074-support-swagger-2-0" target="_blank" rel="noopener noreferrer">most requested feature</a> in this release with new support for the <a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md" target="_blank" rel="noopener noreferrer">Open API 2.0 specification</a> - the successor to the <a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/1.2.md" target="_blank" rel="noopener noreferrer">Swagger Specification</a> that our original <a href="/swagger-api">Swagger API</a> Plugin was based on.</p><p>The Open API Plugin is available in the <a href="https://www.nuget.org/packages/ServiceStack.Api.OpenApi" target="_blank" rel="noopener noreferrer">ServiceStack.Api.OpenApi</a> NuGet package and can be installed with:</p><pre><code>PM&gt; Install-Package ServiceStack.Api.OpenApi
</code></pre><p>Then enabled by registering the <code>OpenApiFeature</code> Plugin in your <code>AppHost</code>:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">Container</span> container<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiFeature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Plugins.Add(new CorsFeature());  //Uncomment to allow access to external sites</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Once enabled the Open API spec for your Services will be available from the <code>/openapi</code> endpoint which opens up a number of new integration possibilities for interacting with your Services:</p><h3 id="embedded-swagger-ui" tabindex="-1">Embedded Swagger UI <a class="header-anchor" href="#embedded-swagger-ui" aria-hidden="true">#</a></h3><p>The immediate benefit is being able to view your Services with the embedded <a href="http://swagger.io/swagger-ui/" target="_blank" rel="noopener noreferrer">Swagger UI</a> available at <code>/swagger-ui/</code> which lets you explore and call your Services from a dynamic UI generated using your Services Open API spec:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/openapi/swagger-ui.png" alt=""></p><h4 id="annotating-your-services" tabindex="-1"><a href="/openapi#openapi-attributes">Annotating your Services</a> <a class="header-anchor" href="#annotating-your-services" aria-hidden="true">#</a></h4><p>You can continue annotating your Services with the existing metadata attributes to further customize how your Services are documented in the Open API spec and displayed in the resulting <code>/swagger-ui</code>, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Api</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Service Description&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiResponse</span><span class="token attribute-arguments"><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>BadRequest<span class="token punctuation">,</span> <span class="token string">&quot;Your request was not understood&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiResponse</span><span class="token attribute-arguments"><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>InternalServerError<span class="token punctuation">,</span> <span class="token string">&quot;Oops, something broke&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/swagger/{Name}&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> Summary <span class="token operator">=</span> <span class="token string">&quot;GET Summary&quot;</span><span class="token punctuation">,</span> Notes <span class="token operator">=</span> <span class="token string">&quot;Notes&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/swagger/{Name}&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> Summary <span class="token operator">=</span> <span class="token string">&quot;POST Summary&quot;</span><span class="token punctuation">,</span> Notes<span class="token operator">=</span><span class="token string">&quot;Notes&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRequest</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiMember</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Name<span class="token operator">=</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> Description <span class="token operator">=</span> <span class="token string">&quot;Name Description&quot;</span><span class="token punctuation">,</span>
        ParameterType <span class="token operator">=</span> <span class="token string">&quot;path&quot;</span><span class="token punctuation">,</span> DataType <span class="token operator">=</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> IsRequired <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiAllowableValues</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Color</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token comment">//Enum</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="calling-authenticated-services" tabindex="-1">Calling Authenticated Services <a class="header-anchor" href="#calling-authenticated-services" aria-hidden="true">#</a></h4><p>Users can call protected Services using the Username and Password fields in Swagger UI which are sent using HTTP Basic Auth that can be enabled in your AppHost with:</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthFeature</span><span class="token punctuation">(</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IAuthProvider<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> 
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BasicAuthProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//Allow Sign-ins with HTTP Basic Auth</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Available in Swagger UI via the <strong>Authorize</strong> button:</p><p><img src="`+n+'" alt=""></p><p>Which will open a dialog to enter your username and password:</p><p><img src="'+s+'" alt=""></p><p>Alternatively you can authenticate outside of Swagger UI (e.g. via an OAuth flow) and then return to <code>/swagger-ui</code> as an Authenticated User where you&#39;ll be able to call authenticated Services.</p><h3 id="azure-api-management" tabindex="-1"><a href="https://azure.microsoft.com/en-us/services/api-management/" target="_blank" rel="noopener noreferrer">Azure API Management</a> <a class="header-anchor" href="#azure-api-management" aria-hidden="true">#</a></h3><p>One of the most popular reasons for Customers wanting Open API support is to be able to make use of <a href="https://azure.microsoft.com/en-us/services/api-management/" target="_blank" rel="noopener noreferrer">Azure API Management</a> which adds a high-level gateway over your APIs that lets you take advantage of value-added solutions like layering on API key or token Security, IP Filtering, rate-limiting and real-time analytics to monitor usage of your APIs.</p><p>This is now possible with Open API support where you can create a new Service under <strong>API management services</strong> in your Azure portal:</p><p><img src="'+a+'" alt=""></p><p><img src="'+e+'" alt=""></p><p>Once Management API is activated (which can take &gt;40mins), click on your API that was just created:</p><p><img src="'+t+'" alt=""></p><p><img src="'+o+'" alt=""></p><p>To add your Services, click <strong>Add API</strong> and choose <strong>OpenAPI specification</strong>:</p><p><img src="'+p+'" alt=""></p><p>Here you can either specify the url for your Services <code>/openapi</code> endpoint or if preferred, upload a local saved copy of your Services <code>openapi.json</code>:</p><p><img src="'+c+'" alt=""></p><p>If the import was successful you&#39;ll see a list of available operations for your Services:</p><p><img src="'+i+`" alt=""></p><h3 id="autorest" tabindex="-1"><a href="https://github.com/Azure/autorest" target="_blank" rel="noopener noreferrer">AutoRest</a> <a class="header-anchor" href="#autorest" aria-hidden="true">#</a></h3><p>Another popular tool you can use with Open API is <a href="https://github.com/Azure/autorest" target="_blank" rel="noopener noreferrer">Azure AutoRest</a> which generates client libraries for accessing RESTful web services in a number of different languages which at this time includes C#, Java, Node.js, TypeScript, Python and Ruby.</p><p>To use AutoRest first install it from npm:</p><pre><code>npm install -g autorest
</code></pre><p>Then you need to download the Open API specification for your Services using a tool like curl:</p><pre><code>curl http://your.domain/openapi &gt; openapi.json
</code></pre><p>Or if you have PowerShell installed, you can use <code>iwr</code>:</p><pre><code>iwr http://your.domain/openapi -o openapi.json
</code></pre><p>You can then use the <code>openapi.json</code> with autorest to generate a client for your API in your preferred language, e.g:</p><pre><code>autorest --latest-release -Input openapi.json -CodeGenerator CSharp -OutputDirectory AutoRestClient -Namespace AutoRestClient
</code></pre><p>This will generate directory containing your model types and REST operations that you can use with the generated client, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SampleProjectAutoRestClient</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:20000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> dto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SampleDto</span> <span class="token punctuation">{</span> <span class="token comment">/* .... */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> 
    <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> client<span class="token punctuation">.</span>SampleOperation<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">body</span><span class="token punctuation">:</span> dto<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// process result</span>
<span class="token punctuation">}</span>
</code></pre></div><p>AutoRest clients will allow usage of tooling that have adopted AutoRest and is a good stop gap solution for generating native clients for languages that <a href="/add-servicestack-reference">Add ServiceStack Reference</a> doesn&#39;t support yet like Python and Ruby.</p><h4 id="autorest-generated-clients-vs-add-servicestack-reference" tabindex="-1">AutoRest Generated Clients vs Add ServiceStack Reference <a class="header-anchor" href="#autorest-generated-clients-vs-add-servicestack-reference" aria-hidden="true">#</a></h4><p>However AutoRest generated clients are similar to WCF Service Reference generated clients where it generates RPC-style Clients that emits both implementation logic and models for sending each request that&#39;s coupled to external HttpClient and <a href="http://JSON.NET" target="_blank" rel="noopener noreferrer">JSON.NET</a> dependencies. This approach generates significantly more code generation that populates a directory containing <a href="https://github.com/ServiceStack/ServiceStack/tree/master/tests/ServiceStack.OpenApi.Tests/GeneratedClient" target="_blank" rel="noopener noreferrer">multiple implementation and Model classes</a> generated for each Service.</p><p>In contrast <a href="/add-servicestack-reference">Add ServiceStack Reference</a> adopts the venerable <a href="https://martinfowler.com/eaaCatalog/dataTransferObject.html" target="_blank" rel="noopener noreferrer">Data Transfer Object</a>, <a href="https://martinfowler.com/eaaCatalog/gateway.html" target="_blank" rel="noopener noreferrer">Gateway</a> and <a href="https://martinfowler.com/eaaCatalog/remoteFacade.html" target="_blank" rel="noopener noreferrer">Remote Facade</a> Service patterns where it only needs to generate clean, implementation-free DTO models that it captures in <strong>a single source file</strong> for all supported languages.</p><p>The generated DTOs are cleaner and more reusable where it isn&#39;t coupled to any Serialization implementation and can be reused in any of ServiceStack&#39;s message-based <a href="/csharp-client#httpwebrequest-service-clients">Service Clients and Serialization Formats</a> or different <a href="/service-gateway">Service Gateway</a> implementations. The models are also richer where it&#39;s able to include additional metadata attributes and marker interfaces that isn&#39;t possible when tunneling through a generic API specification.</p><p>The use of intelligent generic Service Clients will always be able to provide a richer more productive development experience that can enable higher-level, value-added functionality like <a href="/error-handling">Structured Error Handling</a>, <a href="/cache-aware-clients">Smart HTTP Caching</a>, <a href="/auto-batched-requests">Auto Batching</a>, <a href="/encrypted-messaging#encrypted-service-client">Encrypted Messaging</a>, <a href="/autoquery-rdbms#service-clients-support">AutoQuery Streaming</a>, <a href="/csharp-client#client--server-request-compression">Request Compression</a>, integrated authentication and lots more.</p><h2 id="expanding-the-server-events-universe" tabindex="-1">Expanding the Server Events Universe <a class="header-anchor" href="#expanding-the-server-events-universe" aria-hidden="true">#</a></h2><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/server-events/server-events-banner.png" alt=""></p><p><a href="/server-events">Server Events</a> is our integrated and high-performance implementation of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events" target="_blank" rel="noopener noreferrer">Server-Sent Events</a> standard enabling real-time server push notifications over HTTP. Our solution enhances this simple lightweight protocol with rich pub/sub features allowing for <a href="/server-events#sending-server-events">flexible and targeted messaging</a> and intelligent clients enabling a variety of different strategies for easily handling events, includes built-in APIs for easily modifying active subscriptions and querying the state of subscribed channels as well as built-in heartbeats and auto-retries for establishing hassle-free persistent connections to backend servers.</p><p>We&#39;ve made great strides in this release towards our goal of expanding the Server Event ecosystem in popular Mobile, Desktop and Server platforms with new first-class implementations for Android, Java and TypeScript which now includes:</p><ul><li><a href="/csharp-server-events-client">C# Server Events Client</a><ul><li>Xamarin.iOS</li><li>Xamarin.Android</li><li>UWP</li><li>.NET Framework 4.5+</li><li>.NET Core (.NET Standard 1.3+)</li></ul></li><li><a href="/typescript-server-events-client">TypeScript Server Events Client</a><ul><li>Web</li><li>Node.js Server</li><li>React Native <ul><li>iOS</li><li>Android</li></ul></li></ul></li><li><a href="/java-server-events-client">Java Server Events Client</a><ul><li>Android</li><li>JVM 1.7+ (Java, Kotlin, Scala, etc) <ul><li>Java Clients</li><li>Java Servers</li></ul></li></ul></li><li><a href="/javascript-server-events-client">JavaScript (jQuery plugin)</a><ul><li>Web</li></ul></li></ul><p>Our C#, TypeScript and Java Server Event Clients are ports with full feature parity as C#, offering the same functionality behind idiomatic APIs for their respective programming language. The Integration test suite has also been ported to each platform to assert behavior conformance and provides a good reference showcasing the aesthetics of using Server Events Clients in each language:</p><ul><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/tests/ServiceStack.WebHost.Endpoints.Tests/ServerEventTests.cs" target="_blank" rel="noopener noreferrer">C# Server Events Integration Tests</a></li><li><a href="https://github.com/ServiceStack/servicestack-client/blob/master/tests/serverevents.spec.ts" target="_blank" rel="noopener noreferrer">TypeScript Server Events Integration Tests</a></li><li><a href="https://github.com/ServiceStack/ServiceStack.Java/blob/master/src/AndroidClient/client/src/test/java/net/servicestack/client/ServerEventClientTests.java" target="_blank" rel="noopener noreferrer">Java 8 / JVM Server Events Integration Tests</a></li><li><a href="https://github.com/ServiceStack/ServiceStack.Java/blob/master/src/AndroidClient/android/src/androidTest/java/net/servicestack/android/ServerEventClientTests.java" target="_blank" rel="noopener noreferrer">Java 7 / Android Server Events Integration Tests</a></li></ul><p>The feature parity and high-level Typed APIs enabled with <a href="/add-servicestack-reference">Add ServiceStack Reference</a> and the generic Service Clients in each platform significantly reduces the porting efforts for maintaining Native Client Apps in different platforms and languages whilst maximizing knowledge investments and reuse as every client works the same way, utilizing same-name message-based APIs to send Typed DTOs so existing knowledge and documentation is instantly transferable between each supported language.</p><h3 id="java-server-events" tabindex="-1">Java Server Events <a class="header-anchor" href="#java-server-events" aria-hidden="true">#</a></h3><p><a href="/java-server-events-client"><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/java/java-client-logo.png" alt=""></a></p><p>Kicking off our foray into new platforms is the new <a href="/java-server-events-client">Java Server Events Client</a> that&#39;s available in the latest version of ServiceStack&#39;s Java Client libraries which come in 2 flavors, the <a href="https://bintray.com/servicestack/maven/ServiceStack.Android" target="_blank" rel="noopener noreferrer">net.servicestack:android</a> package which can be installed in your Android Studio <strong>build.gradle</strong> with:</p><div class="language-"><pre><code>dependencies {
    implementation &#39;net.servicestack:android:1.0.48&#39;
    ...
}
</code></pre></div><p>Whilst other Java/JVM languages running on JVM (JRE 7+) can use the pure Java <a href="https://bintray.com/servicestack/maven/ServiceStack.Client" target="_blank" rel="noopener noreferrer">net.servicestack:client</a> package which can be installed in Gradle with:</p><div class="language-"><pre><code>implementation &#39;net.servicestack:client:1.0.48&#39;
</code></pre></div><blockquote><p>See the docs for <a href="/java-server-events-client">Maven examples</a></p></blockquote><p>On Android, the <code>AndroidServerEventsClient</code> class should be used which extends the Java <code>ServerEventsClient</code> and enhances it with additional Async APIs and applies platform-specific logic for handling behavioral differences in Android&#39;s implementation of JVM&#39;s <code>HttpURLConnection</code>.</p><p>Whilst Apps running on the JVM can use <code>ServerEventsClient</code> from the <strong>net.servicestack:client</strong> Java library.</p><p>As their direct sub-classes the 2 classes are for the most part source-compatible with all APIs available in <code>ServerEventsClient</code> is by extension, also available in <code>AndroidServerEventsClient</code>.</p><p>Just like C#, you can connect to Server Events with just the <strong>baseUrl</strong> and <strong>channels</strong> you want to connect to. The example below provides an overview exploring how to configure and use different features of the <code>ServerEventsClient</code>:</p><div class="language-java"><pre><code><span class="token class-name">ServerEventsClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AndroidServerEventsClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">,</span> <span class="token string">&quot;home&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setOnConnect</span><span class="token punctuation">(</span>sub <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>                        <span class="token comment">// Successful SSE connection</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;You&#39;ve connected! welcome &quot;</span> <span class="token operator">+</span> sub<span class="token punctuation">.</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setOnJoin</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>                             <span class="token comment">// User has joined subscribed channel</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;Welcome, &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setOnLeave</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>                            <span class="token comment">// User has left subscribed channel</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; has left the building&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setOnUpdate</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>                           <span class="token comment">// User channel subscription was changed</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; has left the building&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setOnMessage</span><span class="token punctuation">(</span>msg <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>                     <span class="token comment">// Invoked for each other message</span>
    <span class="token comment">//... Register custom handlers</span>
    <span class="token punctuation">.</span><span class="token function">registerHandler</span><span class="token punctuation">(</span><span class="token string">&quot;chat&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>client<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>     <span class="token comment">// Invoked for cmd.chat adhoc messages</span>
        <span class="token class-name">ChatMessage</span> chatMsg <span class="token operator">=</span> <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ChatMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>    
    <span class="token punctuation">.</span><span class="token function">registerReceiver</span><span class="token punctuation">(</span><span class="token class-name">MyReceiver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>           <span class="token comment">// Register Global &#39;cmd.&#39; default receiver</span>
    <span class="token punctuation">.</span><span class="token function">registerNamedReceiver</span><span class="token punctuation">(</span><span class="token string">&quot;tv&quot;</span><span class="token punctuation">,</span><span class="token class-name">TvReceiver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// Register named &#39;tv.&#39; receiver</span>
    <span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">&quot;theEvent&quot;</span><span class="token punctuation">,</span> msg <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>           <span class="token comment">// Add listener for pub/sub event trigger</span>
    <span class="token punctuation">.</span><span class="token function">setOnException</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>                     <span class="token comment">// Invoked on each Error</span>
    <span class="token punctuation">.</span><span class="token function">setOnReconnect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>                    <span class="token comment">// Invoked after each auto-reconnect</span>
    <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                     <span class="token comment">// Start listening for Server Events!</span>

<span class="token comment">//Global Receiver Class</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyReceiver</span> <span class="token keyword">extends</span> <span class="token class-name">ServerEventReceiver</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">announce</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>       <span class="token comment">// Handle messages with simple argument</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">chat</span><span class="token punctuation">(</span><span class="token class-name">ChatMessage</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>      <span class="token comment">// Handle messages with complex type argument</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customType</span><span class="token punctuation">(</span><span class="token class-name">CustomType</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// Handle complex types with default selector      </span>
    <span class="token annotation punctuation">@Override</span>                                    <span class="token comment">// Handle other unknown messages</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">noSuchMethod</span><span class="token punctuation">(</span><span class="token class-name">String</span> selector<span class="token punctuation">,</span> <span class="token class-name">Object</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//Named Receiver Class</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TvReciever</span> <span class="token keyword">extends</span> <span class="token class-name">ServerEventReceiver</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token class-name">String</span> videoUrl<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>         <span class="token comment">// Handle &#39;tv.watch {url}&#39; messages </span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>                          <span class="token comment">// Handle &#39;tv.off&#39; messages </span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="java-server-events-client-documentation" tabindex="-1"><a href="/java-server-events-client">Java Server Events Client Documentation</a> <a class="header-anchor" href="#java-server-events-client-documentation" aria-hidden="true">#</a></h4><p>Full documentation exploring <code>ServerEventsClient</code> features are available in the <a href="/java-server-events-client">Java Server Events Client Docs</a>.</p><h3 id="android-java-chat" tabindex="-1"><a href="https://github.com/ServiceStackApps/AndroidJavaChat" target="_blank" rel="noopener noreferrer">Android Java Chat</a> <a class="header-anchor" href="#android-java-chat" aria-hidden="true">#</a></h3><p>To showcase real-world usage of <code>AndroidServerEventsClient</code> in an Android App we&#39;ve ported <a href="https://github.com/ServiceStackApps/AndroidXamarinChat" target="_blank" rel="noopener noreferrer">C# Xamarin Android Chat</a> into <strong>Java 8</strong> using Google&#39;s recommended <a href="https://developer.android.com/studio/index.html" target="_blank" rel="noopener noreferrer">Android Studio Development Environment</a>. In addition to retaining the same functionality as the original <a href="https://github.com/ServiceStackApps/AndroidXamarinChat" target="_blank" rel="noopener noreferrer">C# Xamarin.Android Chat App</a>, it also leverages the native Facebook, Twitter and Google SDK&#39;s to enable seamless and persistent authentication when signing in with Facebook, Twitter or Google User accounts.</p><p>Since <a href="/java-add-servicestack-reference">Java Add ServiceStack Reference</a> and <a href="/java-server-events-client">Java Server Events Client</a> are idiomatic ports of their C# equivalents, both projects utilized a message-based Typed API that significantly reduces the effort to port from their original C# sources, rendering the task down to a straight-forward 1:1 mapping exercise into <strong>Java 8</strong> syntax.</p><p><a href="https://github.com/ServiceStackApps/AndroidJavaChat" target="_blank" rel="noopener noreferrer"><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/java/java-android-chat-screenshot-auth.png" alt=""></a></p><h4 id="android-java-chat-walkthrough" tabindex="-1"><a href="https://github.com/ServiceStackApps/AndroidJavaChat" target="_blank" rel="noopener noreferrer">Android Java Chat Walkthrough</a> <a class="header-anchor" href="#android-java-chat-walkthrough" aria-hidden="true">#</a></h4><p>Full documentation walking through its implementation and explaining core functionality are available in the <a href="https://github.com/ServiceStackApps/AndroidJavaChat" target="_blank" rel="noopener noreferrer">AndroidJavaChat Github project</a>. We&#39;ll explore some key features below to provide some insight into the capabilities available:</p><h3 id="configuring-the-server-events-client" tabindex="-1">Configuring the Server Events Client <a class="header-anchor" href="#configuring-the-server-events-client" aria-hidden="true">#</a></h3><p>The central hub that powers the Android Chat App is the Server Events Client connection that&#39;s registered in <a href="https://github.com/ServiceStackApps/AndroidJavaChat/blob/master/src/androidchat/app/src/main/java/servicestack/net/androidchat/MainActivity.java" target="_blank" rel="noopener noreferrer">MainActivity.java</a> when it&#39;s first created and used to bind the Chat Server Events to our App&#39;s logic, where:</p><ol><li>Upon successful connection: <ol><li>It loads the Chat Message History for the channel</li><li>Updates our User&#39;s Avatar</li></ol></li><li>When a new User Joins: <ol><li>Updates the <code>subscriberList</code> with a list of all Users in the channel</li><li>Instructs our Message History to re-render as its dataset has changed</li></ol></li><li>When the Server Events Connection throws an Exception: <ol><li>Loads an Alert dialog with the Error message</li></ol></li><li>It uses the Custom <code>ReceiverResolver</code> to initialize instances of our Receiver classes</li><li>Registers <code>ChatReceiver</code> to handle all messages sent with the global <code>cmd.*</code> selector</li><li>Registers <code>TvReciever</code> to handle all messages sent with the <code>tv.*</code> selector</li><li>Registers <code>CssReceiver</code> to handle all messages sent with the <code>css.*</code> selector</li></ol><div class="language-java"><pre><code><span class="token class-name">App</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServerEventsClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setOnConnect</span><span class="token punctuation">(</span>connectMsg <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">Extensions</span><span class="token punctuation">.</span><span class="token function">updateChatHistory</span><span class="token punctuation">(</span><span class="token function">getClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmdReceiver<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">Extensions</span><span class="token punctuation">.</span><span class="token function">updateUserProfile</span><span class="token punctuation">(</span>connectMsg<span class="token punctuation">,</span> mainActivity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setOnJoin</span><span class="token punctuation">(</span>msg <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">getClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChannelSubscribersAsync</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            subscriberList <span class="token operator">=</span> r<span class="token punctuation">;</span>
            messageHistoryAdapter<span class="token punctuation">.</span><span class="token function">notifyDataSetChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setOnException</span><span class="token punctuation">(</span>error <span class="token operator">-&gt;</span> mainActivity<span class="token punctuation">.</span><span class="token function">runOnUiThread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
        <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&quot;Error : &quot;</span> <span class="token operator">+</span> error<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ReceiverResolver</span><span class="token punctuation">(</span>cmdReceiver<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">registerReceiver</span><span class="token punctuation">(</span><span class="token class-name">ChatReceiver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">registerNamedReceiver</span><span class="token punctuation">(</span><span class="token string">&quot;tv&quot;</span><span class="token punctuation">,</span> <span class="token class-name">TvReciever</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">registerNamedReceiver</span><span class="token punctuation">(</span><span class="token string">&quot;css&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CssReceiver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Later in <code>onPostCreate()</code> the ServerEventsClient starts the connection and begins listening to Server Events:</p><div class="language-java"><pre><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPostCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token class-name">App</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServerEventsClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="integrated-facebook-twitter-and-google-logins" tabindex="-1">Integrated Facebook, Twitter and Google Logins <a class="header-anchor" href="#integrated-facebook-twitter-and-google-logins" aria-hidden="true">#</a></h3><p>The primary difference between the C# and Java Android Chat Apps is how they&#39;re authenticated. In C# we utilize the <a href="https://components.xamarin.com/view/xamarin.auth" target="_blank" rel="noopener noreferrer">Xamarin.Auth</a> component which wraps a WebView that initiates an OAuth flow by navigating to the server&#39;s <a href="http://chat.netcore.io/auth/facebook" target="_blank" rel="noopener noreferrer">chat.netcore.io/auth/facebook</a> OAuth endpoint. After successful authentication the WebView is redirected back after creating an Authenticated User Session on the server and populating <a href="/sessions">Session Cookies on the HTTP Response</a>. The Cookies are copied from the WebView before being dismissed and used to populate the ServerEventsClient&#39;s Cookies so it&#39;s able to establish an Authenticated connection to the Server Events <code>/event-stream</code>.</p><p>As Xamarin.Auth isn&#39;t available to Java on Android, we can instead take advantage of being able to access the latest 3rd Party Android components and leverage Facebook, Twitter and Google&#39;s SDKs to handle the OAuth flow for us. We can then use the resulting User&#39;s AccessToken to Authenticate with the ServiceStack Server (utilizing a new feature in v4.5.8 announced later).</p><p>As they offer different level of customizations we&#39;ve implemented 2 Login Activities, the 1st Activity shows how to authenticate using Facebook, Twitter and Google&#39;s SDK Login buttons whilst the 2nd Activity shows how to use their SDK classes directly to be able to use your own preferred image login buttons.</p><p>We&#39;ll go through using Facebook&#39;s Login button below but you can find all implementations for Facebook, Twitter and Google Sign In&#39;s <a href="https://github.com/ServiceStackApps/AndroidJavaChat#integrated-facebook-and-twitter-logins" target="_blank" rel="noopener noreferrer">explained in detail in the repo</a>.</p><h3 id="loginbuttonsactivity" tabindex="-1">LoginButtonsActivity <a class="header-anchor" href="#loginbuttonsactivity" aria-hidden="true">#</a></h3><p>After <a href="https://developers.facebook.com/docs/android/getting-started#androidstudio" target="_blank" rel="noopener noreferrer">Installing Facebook&#39;s SDK</a> and registering your <a href="https://github.com/ServiceStackApps/AndroidJavaChat#signing-in-with-facebook-login-button" target="_blank" rel="noopener noreferrer">ApplicationId in the AndroidManifest.xml</a> you can embed Facebook&#39;s Login Button widget in your Activity&#39;s <a href="https://github.com/ServiceStackApps/AndroidJavaChat/blob/master/src/androidchat/app/src/main/res/layout/login_buttons.xml" target="_blank" rel="noopener noreferrer">layout.xml</a>:</p><div class="language-xml"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.twitter.sdk.android.core.identity.TwitterLoginButton</span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/btnTwitterLogin<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.facebook.login.widget.LoginButton</span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/btnFacebookLogin<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center_horizontal<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_marginTop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>30dp<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_marginBottom</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>30dp<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.gms.common.SignInButton</span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/sign_in_button<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>
    <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Guest Login<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/btnGuestLogin<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>Which renders your Activity into something like:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/java/java-android-login-buttons.png" alt=""></p><p>Then you can Authenticate with Facebook Login button by registering a callback on the <code>LoginButton</code>. After that it&#39;s simply a matter of handling the Facebook <code>onSuccess()</code>, <code>onCancel()</code> and <code>onError()</code> callbacks.</p><p>When the <code>onSuccess()</code> callback is fired it means the User has successfully Signed In locally into our Android App, we then need to Authenticate with the <a href="http://chat.netcore.io" target="_blank" rel="noopener noreferrer">ServiceStack Chat Server</a> by making an Authenticated request using the User&#39;s Facebook <code>AccessToken</code>:</p><div class="language-java"><pre><code>facebookCallback <span class="token operator">=</span> <span class="token class-name">CallbackManager<span class="token punctuation">.</span>Factory</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
btnFacebookLogin <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LoginButton</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btnFacebookLogin<span class="token punctuation">)</span><span class="token punctuation">;</span>
btnFacebookLogin<span class="token punctuation">.</span><span class="token function">setReadPermissions</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Ask user for permission to get their email</span>
btnFacebookLogin<span class="token punctuation">.</span><span class="token function">registerCallback</span><span class="token punctuation">(</span>facebookCallback<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">FacebookCallback</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LoginResult</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token class-name">LoginResult</span> loginResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UiHelpers</span><span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>txtStatus<span class="token punctuation">,</span> <span class="token string">&quot;Local sign-in successful, signing into server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">App</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServiceClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">postAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">dtos<span class="token punctuation">.</span></span>Authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setProvider</span><span class="token punctuation">(</span><span class="token string">&quot;facebook&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setAccessToken</span><span class="token punctuation">(</span>loginResult<span class="token punctuation">.</span><span class="token function">getAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setRememberMe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            r <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">UiHelpers</span><span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>txtStatus<span class="token punctuation">,</span> <span class="token string">&quot;Server sign-in successful, opening chat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">stopProgressBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">startActivity</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span>activity<span class="token punctuation">,</span> <span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            error <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">UiHelpers</span><span class="token punctuation">.</span><span class="token function">setStatusError</span><span class="token punctuation">(</span>txtStatus<span class="token punctuation">,</span> <span class="token string">&quot;Server facebook sign-in failed&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">stopProgressBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">stopProgressBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">FacebookException</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">stopProgressBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>One additional callback we need to handle is <code>onActivityResult()</code> to notify the Facebook Login button that the activity it launched to initiate the User&#39;s OAuth flow has completed:</p><div class="language-java"><pre><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onActivityResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> requestCode<span class="token punctuation">,</span> <span class="token keyword">int</span> resultCode<span class="token punctuation">,</span> <span class="token class-name">Intent</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onActivityResult</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> resultCode<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    facebookCallback<span class="token punctuation">.</span><span class="token function">onActivityResult</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> resultCode<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Once the User has authenticated with the ServiceStack Server, the Authenticated <a href="/sessions">Session Cookies</a> are populated on the Service Client which can then be used to make authenticated requests.</p><h3 id="automatically-sign-in-previously-signed-in-users" tabindex="-1"><a href="https://github.com/ServiceStackApps/AndroidJavaChat#automatically-sign-in-previously-signed-in-users" target="_blank" rel="noopener noreferrer">Automatically Sign-In previously Signed In Users</a> <a class="header-anchor" href="#automatically-sign-in-previously-signed-in-users" aria-hidden="true">#</a></h3><p>After the User has successfully Authenticated with Facebook the first time you&#39;ll be able to access their saved token from Facebook&#39;s <code>AccessToken.getCurrentAccessToken()</code> and automatically sign them into ServiceStack Server on future restarts:</p><div class="language-java"><pre><code><span class="token class-name">AccessToken</span> facebookAccessToken <span class="token operator">=</span> <span class="token class-name">AccessToken</span><span class="token punctuation">.</span><span class="token function">getCurrentAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>facebookAccessToken <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    client<span class="token punctuation">.</span><span class="token function">postAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">dtos<span class="token punctuation">.</span></span>Authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setProvider</span><span class="token punctuation">(</span><span class="token string">&quot;facebook&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setAccessToken</span><span class="token punctuation">(</span>facebookAccessToken<span class="token punctuation">.</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setRememberMe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        r <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//User has signed using Saved Access Token</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For more info checkout the <a href="/java-server-events-client">Java Server Events Docs</a> and the walk through of the <a href="https://github.com/ServiceStackApps/AndroidJavaChat/" target="_blank" rel="noopener noreferrer">Android Java Chat App</a>.</p><h2 id="typescript-server-events-client" tabindex="-1">TypeScript Server Events Client <a class="header-anchor" href="#typescript-server-events-client" aria-hidden="true">#</a></h2><p>The TypeScript Server Event Client was also overhauled to match the behavior in the C# and Java Server Events Client including its <a href="https://github.com/ServiceStack/servicestack-client/blob/master/tests/serverevents.spec.ts" target="_blank" rel="noopener noreferrer">integration test suite</a> which performs equally well in both Web and node.js test runners.</p><p>To give you a flavor, here&#39;s a comparative overview you can use to compare with the earlier Java registration example:</p><div class="language-ts"><pre><code><span class="token keyword">const</span> channels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;home&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerEventsClient</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> channels<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    handlers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">onConnect</span><span class="token operator">:</span> <span class="token punctuation">(</span>sub<span class="token operator">:</span>ServerEventConnect<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// Successful SSE connection</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;You&#39;ve connected! welcome &quot;</span> <span class="token operator">+</span> sub<span class="token punctuation">.</span>displayName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">onJoin</span><span class="token operator">:</span> <span class="token punctuation">(</span>msg<span class="token operator">:</span>ServerEventJoin<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        <span class="token comment">// User has joined subscribed channel</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Welcome, &quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span>displayName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">onLeave</span><span class="token operator">:</span> <span class="token punctuation">(</span>msg<span class="token operator">:</span>ServerEventLeave<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token comment">// User has left subscribed channel</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>displayName <span class="token operator">+</span> <span class="token string">&quot; has left the building&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">onUpdate</span><span class="token operator">:</span> <span class="token punctuation">(</span>msg<span class="token operator">:</span>ServerEventUpdate<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token comment">// User channel subscription was changed</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>displayName <span class="token operator">+</span> <span class="token string">&quot; channels subscription were updated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>        
        <span class="token function-variable function">onMessage</span><span class="token operator">:</span> <span class="token punctuation">(</span>msg<span class="token operator">:</span>ServerEventMessage<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// Invoked for each other message</span>
        <span class="token comment">//... Register custom handlers</span>
        <span class="token function-variable function">announce</span><span class="token operator">:</span> <span class="token punctuation">(</span>text<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>             <span class="token comment">// Handle messages with simple argument</span>
        <span class="token function-variable function">chat</span><span class="token operator">:</span> <span class="token punctuation">(</span>chatMsg<span class="token operator">:</span>ChatMessage<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>         <span class="token comment">// Handle messages with complex type argument</span>
        <span class="token function-variable function">CustomMessage</span><span class="token operator">:</span> <span class="token punctuation">(</span>msg<span class="token operator">:</span>CustomMessage<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">// Handle complex types with default selector</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    receivers<span class="token operator">:</span> <span class="token punctuation">{</span> 
        <span class="token comment">//... Register any named receivers</span>
        tv<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token function-variable function">watch</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>             <span class="token comment">// Handle &#39;tv.watch {url}&#39; messages </span>
            <span class="token function-variable function">off</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>                   <span class="token comment">// Handle &#39;tv.off&#39; messages</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">onException</span><span class="token operator">:</span> <span class="token punctuation">(</span>e<span class="token operator">:</span>Error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                 <span class="token comment">// Invoked on each Error</span>
    <span class="token function-variable function">onReconnect</span><span class="token operator">:</span> <span class="token punctuation">(</span>e<span class="token operator">:</span>Error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>                  <span class="token comment">// Invoked after each auto-reconnect</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">registerReceiver</span><span class="token punctuation">(</span>MyReceiver<span class="token punctuation">)</span>                     <span class="token comment">// Register Global &#39;cmd.&#39; default receiver</span>
<span class="token punctuation">.</span><span class="token function">registerNamedReceiver</span><span class="token punctuation">(</span><span class="token string">&quot;window&quot;</span><span class="token punctuation">,</span> window<span class="token punctuation">)</span>          <span class="token comment">// Register named &#39;window.&#39; receiver</span>
<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">&quot;theEvent&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span>e<span class="token operator">:</span>ServerEventMessage<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// Add listener for pub/sub event trigger</span>
<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                             <span class="token comment">// Start listening for Server Events!</span>

<span class="token keyword">class</span> <span class="token class-name">MyReceiver</span> <span class="token keyword">extends</span> <span class="token class-name">ServerEventReceiver</span> <span class="token punctuation">{</span>
    <span class="token function">announce</span><span class="token punctuation">(</span>message<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>                  <span class="token comment">// Handle messages with simple argument</span>
    <span class="token function">chat</span><span class="token punctuation">(</span>request<span class="token operator">:</span> ChatMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>                <span class="token comment">// Handle messages with complex type argument</span>
    <span class="token function">CustomType</span><span class="token punctuation">(</span>request<span class="token operator">:</span> CustomType<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>           <span class="token comment">// Handle complex types with default selector</span>
    <span class="token function">noSuchMethod</span><span class="token punctuation">(</span>selector<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">,</span> message<span class="token operator">:</span>ServerEventMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// Handle other unknown messages</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="built-in-css-receiver" tabindex="-1"><a href="/typescript-server-events-client#postfix-css-selector">Built-in CSS Receiver</a> <a class="header-anchor" href="#built-in-css-receiver" aria-hidden="true">#</a></h3><p>One additional feature the TypeScript (and JavaScript) Server Events Clients have over C# and Java is its built-in <code>css.*</code> handler which lets you automatically <a href="/typescript-server-events-client#modifying-css">modify the styles of any CSS Selector</a> using the format:</p><pre><code>css.{propertyName}\${cssSelector} {propertyValue}
</code></pre><p>Which roughly translates to:</p><pre><code>each(document.querySelectorAll({cssSelector}), x =&gt; x.style.{propertyName} = {propertyValue});
</code></pre><p>So the message:</p><pre><code>css.background$#top #fff
</code></pre><p>Will change the <code>#top</code> element&#39;s background color to white, similar to:</p><pre><code>document.querySelector(&quot;#top&quot;).style.background = &quot;#fff&quot;; 
</code></pre><p>All other &quot;non-Web&quot; Apps will need to register a named CSS Selector to handle these <code>css.*</code> messages and translate its instructions themselves to modify their App&#39;s styles as done in Android Java Chat&#39;s <a href="https://github.com/ServiceStackApps/AndroidJavaChat/blob/master/src/androidchat/app/src/main/java/servicestack/net/androidchat/CssReceiver.java" target="_blank" rel="noopener noreferrer">CssReceiver.java</a>.</p><h4 id="breaking-changes" tabindex="-1">Breaking changes <a class="header-anchor" href="#breaking-changes" aria-hidden="true">#</a></h4><p>As the TypeScript Server Events Client now follows the multi-platform C#/Java design you&#39;ll now need to explicitly call <code>.start()</code> to connect to the Server Events Stream and start listening for messages.</p><p>Type definitions for the built-in Server Event Messages have also been renamed to match their equivalent C#/Java Type names, e.g: <code>ServerEventMessage</code>, <code>ServerEventConnect</code>, <code>ServerEventJoin</code>, etc.</p><h2 id="web-node-js-and-react-native-serverevents-apps" tabindex="-1"><a href="https://github.com/ServiceStackApps/typescript-server-events" target="_blank" rel="noopener noreferrer">Web, Node.js and React Native ServerEvents Apps</a> <a class="header-anchor" href="#web-node-js-and-react-native-serverevents-apps" aria-hidden="true">#</a></h2><p>The TypeScript <a href="https://github.com/ServiceStack/servicestack-client" target="_blank" rel="noopener noreferrer">@servicestack/client</a> npm package is a cross-platform library enabling a rich, productive end-to-end Typed development experience on Web, node.js Server projects, node.js test suites, React Native iOS and Android Mobile Apps - written in either TypeScript or plain JavaScript.</p><p>To help getting started using <a href="https://github.com/ServiceStack/servicestack-client" target="_blank" rel="noopener noreferrer">@servicestack/client</a> in each of JavaScript&#39;s most popular platforms we&#39;ve developed a simple Server Events Web, Node.js and React Native Mobile iOS App that can connect to any Server Events Server and listen to messages published on the subscribed channel. The App also maintains a live synchronized list of Users in the channel that&#39;s automatically updated whenever Users join or leave the channel:</p><p><a href="https://github.com/ServiceStackApps/typescript-server-events" target="_blank" rel="noopener noreferrer"><img src="https://raw.githubusercontent.com/ServiceStack/Assets/master/img/livedemos/typescript-serverevents/typescript-server-events-banner.png" alt=""></a></p><p>Each App uses the optimal starting configuration that enables a productive workflow on each platform and uses the minimum runtime dependencies - essentially just <a href="https://github.com/ServiceStack/servicestack-client" target="_blank" rel="noopener noreferrer">@servicestack/client</a> and its es6-shim and W3C <code>EventSource</code> polyfills on Node.js and React Native where it&#39;s missing a native implementation.</p><h3 id="web-app" tabindex="-1">Web App <a class="header-anchor" href="#web-app" aria-hidden="true">#</a></h3><p>The Web Example App built with less than <strong>&gt;100 lines of application code</strong> that&#39;s made up of the 4 files below with all functionality maintained in <strong>app.ts</strong>:</p><ul><li><a href="https://github.com/ServiceStackApps/typescript-server-events/blob/master/web/src/app.ts" target="_blank" rel="noopener noreferrer">app.ts</a> - Entire App Logic</li><li><a href="https://github.com/ServiceStackApps/typescript-server-events/blob/master/web/src/dtos.ts" target="_blank" rel="noopener noreferrer">dtos.ts</a> - Server generated DTOs from <a href="http://chat.netcore.io/types/typescript" target="_blank" rel="noopener noreferrer">chat.netcore.io/types/typescript</a></li><li><a href="https://github.com/ServiceStackApps/typescript-server-events/blob/master/web/index.html" target="_blank" rel="noopener noreferrer">index.html</a> - Static HTML page</li><li><a href="https://github.com/ServiceStackApps/typescript-server-events/blob/master/web/default.css" target="_blank" rel="noopener noreferrer">default.css</a> - Static default.css styles</li></ul><h3 id="node-js-server-app" tabindex="-1">Node.js Server App <a class="header-anchor" href="#node-js-server-app" aria-hidden="true">#</a></h3><p>The <a href="https://github.com/ServiceStackApps/typescript-server-events/tree/master/node" target="_blank" rel="noopener noreferrer">/node</a> server.js app has the same functionality as the Web App except instead of connecting to the <a href="http://chat.netcore.io" target="_blank" rel="noopener noreferrer">chat.netcore.io</a> Events stream on the client, all connections are made in node.js and it&#39;s only the server state that&#39;s sent to the client, which it uses to render the UI.</p><p>As the functionality of the app remains the same, the Node.js App is able to reuse the Web App&#39;s existing <code>dtos.ts</code>, <code>.html</code> and .<code>css</code>:</p><ul><li><a href="https://github.com/ServiceStackApps/typescript-server-events/blob/master/node/src/dtos.ts" target="_blank" rel="noopener noreferrer">dtos.ts</a></li><li><a href="https://github.com/ServiceStackApps/typescript-server-events/blob/master/node/index.html" target="_blank" rel="noopener noreferrer">index.html</a></li><li><a href="https://github.com/ServiceStackApps/typescript-server-events/blob/master/node/default.css" target="_blank" rel="noopener noreferrer">default.css</a></li></ul><p>The difference is in the App&#39;s logic which is now split into 2 files, one for the node.js <strong>server.ts</strong> which now contains most of the App&#39;s functionality and another for the Web clients <strong>app.ts</strong>, now relegated to periodically updating the UI with the node.js server state:</p><ul><li><a href="https://github.com/ServiceStackApps/typescript-server-events/blob/master/node/server.ts" target="_blank" rel="noopener noreferrer">server.ts</a> - maintain all client and server events connection to <a href="http://chat.netcore.io" target="_blank" rel="noopener noreferrer">chat.netcore.io</a></li><li><a href="https://github.com/ServiceStackApps/typescript-server-events/blob/master/node/src/app.ts" target="_blank" rel="noopener noreferrer">app.ts</a> - periodically render node.js state to HTML UI</li></ul><h3 id="react-native-mobile-app" tabindex="-1">React Native Mobile App <a class="header-anchor" href="#react-native-mobile-app" aria-hidden="true">#</a></h3><p>Arguably the most exciting platform you can build with JavaScript in recent times is Facebook&#39;s <a href="https://facebook.github.io/react-native/" target="_blank" rel="noopener noreferrer">React Native</a> where you can take advantage of <a href="https://facebook.github.io/react/" target="_blank" rel="noopener noreferrer">React</a> to develop Native iOS and Android Mobile Apps with Web App productivity. Thanks to Facebook&#39;s relentless focus on developer tooling and productivity, building rich native iOS and Android UI&#39;s can now be done at record speed in a fast iterative workflow with UI changes visible instantly.</p><p>The <a href="https://facebook.github.io/react-native/docs/getting-started.html" target="_blank" rel="noopener noreferrer">React Native Getting Started Guide</a> will get you up and running with everything you need to start building Native Mobile Apps which is also pre-configured with Babel so you can take advantage of <a href="https://facebook.github.io/react-native/docs/javascript-environment.html" target="_blank" rel="noopener noreferrer">advanced ES6 and ES7 language features</a>.</p><p>For the React Native App we&#39;ve decided to stick with React Native default of using ES6/JavaScript instead of TypeScript to showcase that we&#39;ll still able to enjoy the same simplified programming model and concrete Types that <a href="https://github.com/ServiceStack/servicestack-client" target="_blank" rel="noopener noreferrer">@servicestack/client</a> enables, in pure JavaScript Apps.</p><h4 id="react-native-structure" tabindex="-1">React Native Structure <a class="header-anchor" href="#react-native-structure" aria-hidden="true">#</a></h4><p>Unlike Web Apps which splits behavior, layout and styles across multiple <code>.ts</code>, <code>.html</code> and <code>.css</code> files, React Apps can be built using just JavaScript as seen in the single <strong>index.ios.js</strong> which contains the App&#39;s entire functionality, layout and style in <a href="https://github.com/ServiceStackApps/typescript-server-events/blob/master/reactnative/index.ios.js" target="_blank" rel="noopener noreferrer">&lt;200 Lines of JavaScript</a>:</p><ul><li><a href="https://github.com/ServiceStackApps/typescript-server-events/blob/master/reactnative/index.ios.js" target="_blank" rel="noopener noreferrer">index.ios.js</a> - The entire App including all behavior, layout and styles</li><li><a href="https://github.com/ServiceStackApps/typescript-server-events/blob/master/reactnative/dtos.js" target="_blank" rel="noopener noreferrer">dtos.js</a> - Server DTOs from <a href="http://chat.netcore.io/types/typescript" target="_blank" rel="noopener noreferrer">chat.netcore.io/types/typescript</a> and compiled into .js using <code>tsc</code></li></ul><p>The smaller screen size means our React Native App adopts a more compact layout but otherwise retains similar functionality to the other Web Apps which looks like:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/Assets/master/img/livedemos/typescript-serverevents/react-native.png" alt=""></p><h3 id="typed-api-calls-in-javascript" tabindex="-1">Typed API calls in JavaScript <a class="header-anchor" href="#typed-api-calls-in-javascript" aria-hidden="true">#</a></h3><p>Despite the React Native App having been developed in ES6/JavaScript, it still uses exactly the same syntax for making Typed API calls, importing libraries and Server&#39;s Typed DTOs.</p><p>Only one additional step is needed after importing the Servers TypeScript DTOs which is to compile it to JavaScript, which can be done by invoking the TypeScript compiler with the file directly:</p><pre><code>tsc dtos.ts
</code></pre><p>Now the Server APIs can be consumed as normal by populating a Request DTO and sending it using the generic <code>JsonServiceClient</code>:</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ServerEventsClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@servicestack/client&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PostChatToChannel <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./dtos&#39;</span><span class="token punctuation">;</span>

<span class="token function-variable function">sendChat</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>txtChat <span class="token operator">||</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>sub<span class="token punctuation">)</span> 
    <span class="token keyword">return</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PostChatToChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  request<span class="token punctuation">.</span>from <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sub<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
  request<span class="token punctuation">.</span>channel <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>channel<span class="token punctuation">;</span>    
  request<span class="token punctuation">.</span>selector <span class="token operator">=</span> <span class="token string">&quot;cmd.chat&quot;</span><span class="token punctuation">;</span>
  request<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>txtChat<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>client<span class="token punctuation">.</span>serviceClient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In addition to great code reuse, JavaScript is surprisingly also able to benefit from the original TypeScript definitions thanks to <a href="https://github.com/Microsoft/TypeScript-wiki/blob/master/JavaScript-Language-Service-in-Visual-Studio.md" target="_blank" rel="noopener noreferrer">VS Code&#39;s Salsa Engine</a> which provides the Language Services for both TypeScript and JavaScript source files in VS Code, so even though there are no Type annotations in JavaScript it&#39;s still able to provide rich intelli-sense from the original <code>dtos.ts</code> TypeScript sources:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/Assets/master/img/livedemos/typescript-serverevents/js-intellisense.png" alt=""></p><p><code>Ctrl+Click</code> on the Request DTO Type also navigates to the Type definition in <code>dtos.ts</code> despite none of the properties existing in the compiled <a href="https://github.com/ServiceStackApps/typescript-server-events/blob/master/reactnative/dtos.js" target="_blank" rel="noopener noreferrer">dtos.js</a> that&#39;s used at runtime.</p><h3 id="consuming-servicestack-services-in-typescript-or-javascript-projects" tabindex="-1">Consuming ServiceStack Services in TypeScript or JavaScript projects <a class="header-anchor" href="#consuming-servicestack-services-in-typescript-or-javascript-projects" aria-hidden="true">#</a></h3><p>For more info developing Apps using <strong>@servicestack/client</strong> see the complete source code and detailed walkthrough in the <a href="https://github.com/ServiceStackApps/typescript-server-events" target="_blank" rel="noopener noreferrer">typescript-server-events</a> project.</p><h2 id="c-server-events-client" tabindex="-1">C# Server Events Client <a class="header-anchor" href="#c-server-events-client" aria-hidden="true">#</a></h2><p>The <a href="/csharp-server-events-client">C# Server Events Client</a> also had a number of refinements added to it, primarily to maintain behavior and API conformance with the Java and TypeScript Client Libraries:</p><p>Distinct <code>OnJoin</code>, <code>OnLeave</code> <code>OnUpdate</code> and <code>OnReconnect</code> callbacks are now available which can be used to handle a specific event, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ServerEventsClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">,</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    OnJoin <span class="token operator">=</span> msg <span class="token operator">=&gt;</span> <span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">,</span>
    OnLeave <span class="token operator">=</span> msg <span class="token operator">=&gt;</span> <span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">,</span>
    OnUpdate <span class="token operator">=</span> msg <span class="token operator">=&gt;</span> <span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">,</span>
    OnReconnect <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="event-triggers" tabindex="-1">Event Triggers <a class="header-anchor" href="#event-triggers" aria-hidden="true">#</a></h3><p>Triggers enable a pub/sub event model where multiple listeners can subscribe and be notified of an event. Registering an event handler can be done at anytime using the <code>addListener()</code> API, e.g:</p><div class="language-csharp"><pre><code>client<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">&quot;customEvent&quot;</span><span class="token punctuation">,</span> msg <span class="token operator">=&gt;</span> <span class="token function">updateUI</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">&quot;customEvent&quot;</span><span class="token punctuation">,</span> msg <span class="token operator">=&gt;</span> <span class="token function">updateState</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="strictmode" tabindex="-1">StrictMode <a class="header-anchor" href="#strictmode" aria-hidden="true">#</a></h3><p>As C# is a statically-typed language it&#39;s able to use the Type Information in method signatures to determine which method to invoke which allows us to be able to use any name for our Methods and Properties, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyGlobalReceiver</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ServerEventReceiver</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">FooMethod</span><span class="token punctuation">(</span><span class="token class-name">CustomType</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> 

    <span class="token keyword">public</span> <span class="token return-type class-name">SetterType</span> BarSetter <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>But this isn&#39;t possible in other dynamic languages or JVM&#39;s Type erasure so the method or property name needs to match the Complex Type message being sent so we can determine what to invoke. To encourage development of portable source code across different languages we&#39;ve added a <code>StrictMode</code> flag to also enforce this constraint in C# clients as well, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyGlobalReceiver</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ServerEventReceiver</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CustomType</span><span class="token punctuation">(</span><span class="token class-name">CustomType</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> 

    <span class="token keyword">public</span> <span class="token return-type class-name">SetterType</span> SetterType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="parameterless-methods" tabindex="-1">Parameterless methods <a class="header-anchor" href="#parameterless-methods" aria-hidden="true">#</a></h3><p>You can now invoke methods without arguments as seen with <code>Toggle()</code> below which can be used to handle <a href="http://chat.netcore.io/" target="_blank" rel="noopener noreferrer">Chat&#39;s</a> <code>cmd.toggle</code> command, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyGlobalReceiver</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ServerEventReceiver</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="typescript-servicestack-client-improvements" tabindex="-1">TypeScript @servicestack/client improvements <a class="header-anchor" href="#typescript-servicestack-client-improvements" aria-hidden="true">#</a></h2><p>New APIs have been added to TypeScript&#39;s <a href="https://github.com/ServiceStack/servicestack-client" target="_blank" rel="noopener noreferrer">@servicestack/client</a> to catch up with the additional flexibility and features available in <a href="/csharp-client">C#/.NET Service Clients</a>:</p><h3 id="sending-additional-arguments-with-typed-api-requests" tabindex="-1">Sending additional arguments with Typed API Requests <a class="header-anchor" href="#sending-additional-arguments-with-typed-api-requests" aria-hidden="true">#</a></h3><p>Many AutoQuery Services utilize <a href="/autoquery-rdbms#implicit-conventions">implicit conventions</a> to query fields that aren&#39;t explicitly defined on AutoQuery Request DTOs, these can now be queried by specifying additional arguments with the typed Request DTO, e.g:</p><div class="language-ts"><pre><code><span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FindTechStacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token punctuation">{</span> VendorName<span class="token operator">:</span> <span class="token string">&quot;ServiceStack&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// typed to QueryResponse&lt;TechnologyStack&gt; </span>
</code></pre></div><p>Which will <a href="https://techstacks.io/ss_admin/autoquery/FindTechStacks" target="_blank" rel="noopener noreferrer">return TechStacks</a> developed by ServiceStack.</p><h3 id="calling-apis-with-custom-urls" tabindex="-1">Calling APIs with Custom URLs <a class="header-anchor" href="#calling-apis-with-custom-urls" aria-hidden="true">#</a></h3><p>In addition to Typed API Requests you can now also call Services using relative or absolute urls, e.g:</p><div class="language-ts"><pre><code>client<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>GetTechnologyResponse<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;/technology/ServiceStack&quot;</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>GetTechnologyResponse<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;https://techstacks.io/technology/ServiceStack&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// GET https://techstacks.io/technology?Slug=ServiceStack</span>
client<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>GetTechnologyResponse<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;/technology&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> Slug<span class="token operator">:</span> <span class="token string">&quot;ServiceStack&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> 
</code></pre></div><h2 id="relaxed-typescript-definitions" tabindex="-1">Relaxed TypeScript Definitions <a class="header-anchor" href="#relaxed-typescript-definitions" aria-hidden="true">#</a></h2><p><a href="/typescript-add-servicestack-reference">TypeScript Add ServiceStack Reference</a> can generate either TypeScript Concrete Types or Ambient Interface Definitions for your Services at the following routes:</p><ul><li><a href="https://techstacks.io/types/typescript" target="_blank" rel="noopener noreferrer">/types/typescript</a> - Server Concrete DTO Types</li><li><a href="https://techstacks.io/types/typescript.d" target="_blank" rel="noopener noreferrer">/types/typescript.d</a> - Server Ambient Interface Definitions</li></ul><p>These were previously both generated to enable an optimal end-to-end Typed API for use in the TypeScript <strong>@servicestack/client</strong> which needs to embed metadata in Request DTOs to retain necessary type information that remains preserved after minification.</p><p>However a number of Customers have indicated they wish to continue using their preferred HTTP Client of choice (e.g. <a href="https://github.com/2muchcoffeecom/ng2-restangular" target="_blank" rel="noopener noreferrer">restangular</a>) and would instead prefer to use the ambient interface definitions to add compiler Type Checking to their object literal requests like:</p><div class="language-ts"><pre><code><span class="token keyword">let</span> request<span class="token operator">:</span>QueryContracts <span class="token operator">=</span> <span class="token punctuation">{</span> accountId<span class="token operator">:</span> <span class="token number">1234</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>This use-case was hindered by the additional <code>IReturn&lt;T&gt;</code> metadata requirements implemented by Request DTOs which have now been relaxed in this release so they can be used to Type object literals as above. But as metadata in Request DTO interface definitions are no longer inferrable, their return Type and route will need to be supplied on each call-site, e.g:</p><div class="language-ts"><pre><code><span class="token keyword">let</span> request<span class="token operator">:</span>FindTechnologies <span class="token operator">=</span> <span class="token punctuation">{</span> vendorName<span class="token operator">:</span> <span class="token string">&quot;ServiceStack&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>QueryResponse<span class="token operator">&lt;</span>Technology<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;/technology/search&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//typed response</span>
</code></pre></div><p>But if you are using the TypeScript <code>JsonServiceClient</code> we recommend instead using the Server Concrete DTOs to enable a succinct Typed API free of unnecessary boilerplate, e.g:</p><div class="language-ts"><pre><code><span class="token keyword">let</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FindTechnologies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span>vendorName <span class="token operator">=</span> <span class="token string">&quot;ServiceStack&quot;</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//typed response</span>
</code></pre></div><h2 id="authentication-via-oauth-accesstokens" tabindex="-1">Authentication via OAuth AccessTokens <a class="header-anchor" href="#authentication-via-oauth-accesstokens" aria-hidden="true">#</a></h2><p>To improve OAuth Sign In integration from native Mobile or Desktop Apps we&#39;ve added support for direct Authentication via AccessTokens which can dramatically simplify the Development and User Experience by being able to leverage the Native Facebook, Twitter and Google Client SDK&#39;s to Sign In users locally then reuse their local <strong>AccessToken</strong> to Authenticate with back-end ServiceStack Servers. This feature is what&#39;s used to enable <a href="https://github.com/ServiceStackApps/AndroidJavaChat/#integrated-facebook-twitter-and-google-logins" target="_blank" rel="noopener noreferrer">Integrated Facebook, Twitter and Google Logins</a> in Android Java Chat and be able to <a href="https://github.com/ServiceStackApps/AndroidJavaChat#automatically-sign-in-previously-signed-in-users" target="_blank" rel="noopener noreferrer">Automatically Sign In users with saved AccessTokens</a>.</p><p>This capability is now available on the popular OAuth Providers below:</p><ul><li><code>FacebookAuthProvider</code> - Sign in with Facebook</li><li><code>TwitterAuthProvider</code> - Sign in with Twitter</li><li><code>GithubAuthProvider</code> - Sign in with Github</li><li><code>GoogleOAuth2Provider</code> - Sign in with Google</li></ul><p>It can also be enabled in other OAuth2 Providers by implementing <code>VerifyAccessToken</code> to manually validate whether the provided AccessToken is valid with the registered OAuth App. The API to validate Access Tokens isn&#39;t part of the OAuth2 specification and is different (and often missing) for other OAuth2 providers. As an example, the <code>GoogleOAuth2Provider</code> uses a <code>VerifyAccessToken</code> implementation that&#39;s similar to:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">GoogleOAuth2Provider</span> <span class="token punctuation">{</span>
    VerifyAccessToken <span class="token operator">=</span> accessToken <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> url <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">accessToken</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> json <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">GetJsonFromUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> obj <span class="token operator">=</span> JsonObject<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> obj<span class="token punctuation">[</span><span class="token string">&quot;issued_to&quot;</span><span class="token punctuation">]</span> <span class="token operator">==</span> ConsumerKey<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="client-authentication-with-accesstoken" tabindex="-1">Client Authentication with AccessToken <a class="header-anchor" href="#client-authentication-with-accesstoken" aria-hidden="true">#</a></h3><p>Clients can utilize this feature with the new <code>AccessToken</code> and <code>AccessTokenSecret</code> properties on the existing <code>Authenticate</code> request DTO, sent with the <strong>provider</strong> that the AccessToken is for, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Authenticate</span> <span class="token punctuation">{</span>
    provider <span class="token operator">=</span> <span class="token string">&quot;facebook&quot;</span><span class="token punctuation">,</span>
    AccessToken <span class="token operator">=</span> facebookAccessToken<span class="token punctuation">,</span>
    RememberMe <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>Most OAuth Providers only require sending an <code>AccessToken</code> with Twitter being the exception which also requires sending an <code>AccessTokenSecret</code>.</p></blockquote><p>This works similarly to other <a href="/authentication-and-authorization#authenticating-with-net-service-clients">Authenticated Client Requests</a> where if successful it will return a populated <code>AuthenticateResponse</code> DTO and populate the Service Client with Authenticated <a href="/sessions">Session Cookies</a> it uses to make authenticated API calls on subsequent requests.</p><h2 id="jwt-refresh-tokens" tabindex="-1">JWT Refresh Tokens <a class="header-anchor" href="#jwt-refresh-tokens" aria-hidden="true">#</a></h2><p>Support for Refresh Tokens is now available in the <a href="/jwt-authprovider">JWT Auth Provider</a> where new <strong>JWT Tokens</strong> can now be generated from a longer-lived <code>RefreshToken</code>. JWT is our <a href="/jwt-authprovider#stateless-auth-microservices">preferred choice for Microservices</a> as it enables Stateless Auth where only 1 Microservice needs to be able to issue JWT Tokens and be configured to manage User Authentication. This alleviates the configuration and management burden from all other Microservices who&#39;ll be able to Authenticate Requests by just validating and populating the User&#39;s Session embedded in JWT Tokens. JWT is also a high-performance solution that unlike every other Auth Provider requires no I/O or Server state to authenticate the user and populate its User Session.</p><p>But this also means that the User Session embedded in the JWT Token is detached and becomes stale the moment it&#39;s created as any changes to the User like adding or removing Roles &amp; Permissions or Locking the User&#39;s Account aren&#39;t visible and won&#39;t take effect until the JWT Token expires, prompting the client to retrieve a new one. Previously this meant they&#39;d need to re-authenticate again to fetch a fresh JWT Token which depending on the Auth Provider used would require resending Username/Password credentials, an API Key or initiate a new OAuth flow, etc.</p><p>This can now be transparently handled with Refresh Tokens which can be used to fetch new JWT Tokens without needing to re-authenticate with a separate Auth Provider.</p><h3 id="accessing-refresh-tokens" tabindex="-1">Accessing Refresh Tokens <a class="header-anchor" href="#accessing-refresh-tokens" aria-hidden="true">#</a></h3><p>Just like JWT Tokens, Refresh Tokens are populated on the <code>AuthenticateResponse</code> DTO after successfully authenticating via any registered Auth Provider, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Authenticate</span> <span class="token punctuation">{</span>
    provider <span class="token operator">=</span> <span class="token string">&quot;credentials&quot;</span><span class="token punctuation">,</span>
    UserName <span class="token operator">=</span> userName<span class="token punctuation">,</span>
    Password <span class="token operator">=</span> password<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> jwtToken <span class="token operator">=</span> response<span class="token punctuation">.</span>BearerToken<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> refreshToken <span class="token operator">=</span> response<span class="token punctuation">.</span>RefreshToken<span class="token punctuation">;</span>
</code></pre></div><h3 id="lifetimes-of-tokens" tabindex="-1">Lifetimes of tokens <a class="header-anchor" href="#lifetimes-of-tokens" aria-hidden="true">#</a></h3><p>The default expiry time of JWT and Refresh Tokens below can be overridden when registering the <code>JwtAuthProvider</code>:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span> <span class="token punctuation">{</span>
    ExpireTokensIn        <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromDays</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// JWT Token Expiry</span>
    ExpireRefreshTokensIn <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromDays</span><span class="token punctuation">(</span><span class="token number">365</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Refresh Token Expiry</span>
<span class="token punctuation">}</span>
</code></pre></div><p>These expiry times are use-case specific so you&#39;ll want to check what values are appropriate for your System. The <code>ExpireTokensIn</code> property controls how long a client is allowed to make Authenticated Requests with the same JWT Token, whilst the <code>ExpireRefreshTokensIn</code> property controls how long the client can keep requesting new JWT Tokens using the same Refresh Token before needing to re-authenticate and generate a new one.</p><h3 id="using-jwt-and-refresh-tokens" tabindex="-1">Using JWT and Refresh Tokens <a class="header-anchor" href="#using-jwt-and-refresh-tokens" aria-hidden="true">#</a></h3><p>Service Clients can be configured to use JWT Tokens in a <a href="/jwt-authprovider#sending-jwt-with-service-clients">number of different ways</a>, one option is to set a <strong>Bearer Token</strong>, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    BearerToken <span class="token operator">=</span> jwtToken
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Which will allow Service Clients to be able to make authenticated requests up until the JWT is no longer valid at which point they&#39;ll start throwing <strong>401 Unauthorized</strong> HTTP Exceptions which you can catch and manually call the built-in <code>GetAccessToken</code> Service with your Refresh Token to generate a fresh Access Token, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">try</span> 
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">WebServiceException</span> ex<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ex<span class="token punctuation">.</span>StatusCode <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>HttpStatusCode<span class="token punctuation">.</span>Unauthorized<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> refreshResponse <span class="token operator">=</span> authClient<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">GetAccessToken</span> <span class="token punctuation">{</span>
            RefreshToken <span class="token operator">=</span> refreshToken
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        authClient<span class="token punctuation">.</span>BearerToken <span class="token operator">=</span> refreshResponse<span class="token punctuation">.</span>AccessToken<span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Whilst this shows the sequence of events that lead to retrieving a new JWT Token, we can avoid the dance of handling every Web Service Exception with the <code>OnAuthenticationRequired</code> callback which gets invoked anytime the Service Client receives a <strong>401 Unauthorized</strong> Response. We can use this callback to fetch a new JWT Token before it auto-retries the same request, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    BearerToken <span class="token operator">=</span> jwtToken
<span class="token punctuation">}</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span>OnAuthenticationRequired <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    client<span class="token punctuation">.</span>BearerToken <span class="token operator">=</span> authClient<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">GetAccessToken</span> <span class="token punctuation">{</span>
        RefreshToken <span class="token operator">=</span> refreshToken<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>AccessToken<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In order to provide the simplest development experience possible we&#39;ve gone a step further and made it so you&#39;ll only need to specify the Refresh Token on the Service Client and it will take care of transparently fetching a new JWT Token behind-the-scenes. You don&#39;t even need to configure the client with a JWT Token as it will just fetch a new one on first use, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    RefreshToken <span class="token operator">=</span> refreshToken<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="handling-refresh-tokens-expiring" tabindex="-1">Handling Refresh Tokens Expiring <a class="header-anchor" href="#handling-refresh-tokens-expiring" aria-hidden="true">#</a></h3><p>For the case when Refresh Tokens themselves expire the <code>WebServiceException</code> is wrapped in a typed <code>RefreshTokenException</code> to make it easier to handle initiating the flow to re-authenticate the User, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">try</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Secured</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RefreshTokenException</span> ex<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token comment">// re-authenticate to get new RefreshToken</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="using-an-alternative-jwt-server" tabindex="-1">Using an alternative JWT Server <a class="header-anchor" href="#using-an-alternative-jwt-server" aria-hidden="true">#</a></h3><p>By default Service Clients will assume they should call the same ServiceStack Instance at the BaseUrl it&#39;s configured with to fetch new JWT Tokens. If instead refresh tokens need to be sent to a different server, it can be specified using the <code>RefreshTokenUri</code> property, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    RefreshToken <span class="token operator">=</span> refreshToken<span class="token punctuation">,</span>
    RefreshTokenUri <span class="token operator">=</span> authBaseUrl <span class="token operator">+</span> <span class="token string">&quot;/access-token&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>The <code>RefreshToken</code> functionality displayed above is available to all Service Clients</p></blockquote><h3 id="requires-user-auth-repository" tabindex="-1">Requires User Auth Repository <a class="header-anchor" href="#requires-user-auth-repository" aria-hidden="true">#</a></h3><p>One limitation for Refresh Tokens support is that it must be configured to use a <a href="/authentication-and-authorization#user-auth-repository">User Auth Repository</a> which is the persisted data source used to rehydrate the User Session that&#39;s embedded in the JWT Token.</p><h3 id="validate-token-callbacks" tabindex="-1">Validate Token Callbacks <a class="header-anchor" href="#validate-token-callbacks" aria-hidden="true">#</a></h3><p>The new delegates below can be used to apply additional Custom Logic to validate JWT or Refresh Tokens, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span> <span class="token punctuation">{</span>
    ValidateToken <span class="token operator">=</span> <span class="token punctuation">(</span>jwtBody<span class="token punctuation">,</span> req<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">MyValidateJwtForUserId</span><span class="token punctuation">(</span>jwtBody<span class="token punctuation">[</span><span class="token string">&quot;sub&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ValidateRefreshToken <span class="token operator">=</span> <span class="token punctuation">(</span>jwtBody<span class="token punctuation">,</span> req<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">MyValidateRefreshTokenForUserId</span><span class="token punctuation">(</span>jwtBody<span class="token punctuation">[</span><span class="token string">&quot;sub&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Keep in mind a large appeal of JWT&#39;s are its performance and scalability characteristics where it requires no I/O calls to Authenticate Users so it&#39;s preferable to apply custom logic when creating or refreshing JWT tokens in <code>ValidateRefreshToken</code> instead of each time the JWT Token is used in <code>ValidateToken</code>. Shortening the expiry of JWT Tokens is another solution if custom validation logic is needed to be applied more frequently.</p><h2 id="fluent-validation-upgraded" tabindex="-1">Fluent Validation Upgraded <a class="header-anchor" href="#fluent-validation-upgraded" aria-hidden="true">#</a></h2><p>Another major feature added in this release was contributed by the community with <a href="https://github.com/wwwlicious" target="_blank" rel="noopener noreferrer">Scott Mackay</a> upgrading our internal Fluent Validation implementation to the latest version of <a href="https://github.com/JeremySkinner/FluentValidation" target="_blank" rel="noopener noreferrer">FluentValidation</a>. Special care was taken to maintain backwards compatibility where ServiceStack enhancements were retrofitted on top of the new version and existing Error Codes were preserved to ensure minimal disruption with existing code bases.</p><p>There are still some minor behavioral changes due to the behavior in FluentValidation having changed, e.g previously the <a href="https://github.com/ServiceStack/ServiceStack/blob/v4.5.6/src/ServiceStack/FluentValidation/Validators/LengthValidator.cs#L44" target="_blank" rel="noopener noreferrer">LengthValidator</a> would assume a <code>null</code> string had a length of <code>0</code> and therefore fail a minimum length validation test:</p><pre><code>RuleFor(x =&gt; x.Address).Length(20, 250);
</code></pre><p>The current behavior for <code>null</code> values is to <a href="https://github.com/ServiceStack/ServiceStack/blob/5d306f87e058dd8ebef22aa2c739b6708fac45b6/src/ServiceStack/FluentValidation/Validators/LengthValidator.cs#L55" target="_blank" rel="noopener noreferrer">skip validation</a> so validation is only applied when the property has a value. To assert the previous behavior you&#39;ll need to explicitly assert that the property shouldn&#39;t be <code>null</code>, e.g:</p><pre><code>RuleFor(x =&gt; x.Address).NotNull().Length(20, 250);
</code></pre><h3 id="async-validators" tabindex="-1">Async Validators <a class="header-anchor" href="#async-validators" aria-hidden="true">#</a></h3><p>One of the benefits from using the latest version of Fluent Validation is we now have support for Async Validators! Async validators can be registered using the <code>MustAsync</code> validator where you could simulate the following built-in <strong>Not Empty</strong> validation:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRequestValidator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AbstractValidator<span class="token punctuation">&lt;</span>MyRequest<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">MyRequestValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">RuleFor</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">NotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>And replace it with an Async version that uses the <a href="/service-gateway">Service Gateway</a> to call a custom Async <code>GetStringLength</code> Service that returns the same <code>ErrorCode</code> and Error Message as the <strong>Not Empty</strong> validator:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRequestValidator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AbstractValidator<span class="token punctuation">&lt;</span>MyRequest<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">MyRequestValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">RuleFor</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">MustAsync</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span> token<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
            <span class="token punctuation">(</span><span class="token keyword">await</span> Gateway<span class="token punctuation">.</span><span class="token function">SendAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">GetStringLength</span> <span class="token punctuation">{</span> Value <span class="token operator">=</span> s <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Result <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">WithMessage</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;Name&#39; should not be empty.&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">WithErrorCode</span><span class="token punctuation">(</span><span class="token string">&quot;NotEmpty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ServiceStack uses the most optimal validation method when possible where it only calls Fluent Validation&#39;s <code>validator.ValidateAsync()</code> if the code-path contains an Async Validator, where given this Validator:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRequestValidator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AbstractValidator<span class="token punctuation">&lt;</span>MyRequest<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">MyRequestValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">RuleSet</span><span class="token punctuation">(</span>ApplyTo<span class="token punctuation">.</span>Post<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            <span class="token function">RuleFor</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">MustAsync</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span> token<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
                <span class="token punctuation">(</span><span class="token keyword">await</span> Gateway<span class="token punctuation">.</span><span class="token function">SendAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">GetStringLength</span> <span class="token punctuation">{</span> Value <span class="token operator">=</span> s <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Result <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">WithMessage</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;Name&#39; should not be empty.&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">WithErrorCode</span><span class="token punctuation">(</span><span class="token string">&quot;NotEmpty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">RuleSet</span><span class="token punctuation">(</span>ApplyTo<span class="token punctuation">.</span>Put<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            <span class="token function">RuleFor</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">NotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">RuleFor</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Age<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GreaterThan</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If the <code>MyRequest</code> Service was called using the HTTP <strong>POST</strong> method ServiceStack will call <code>validator.ValidateAsync()</code> to execute the validator asynchronously but if it&#39;s called with the HTTP <strong>PUT</strong> method it will avoid async overhead and execute the validator synchronously:</p><div class="language-csharp"><pre><code>client<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyRequest</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;POST&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// calls validator.ValidateAsync()</span>
client<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyRequest</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;PUT&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// calls validator.Validate()</span>
</code></pre></div><h2 id="async-global-request-filters" tabindex="-1">Async Global Request Filters <a class="header-anchor" href="#async-global-request-filters" aria-hidden="true">#</a></h2><p>To properly implement Async Validators we also needed Async Request Filters which were also added in this release where you can now register non-blocking Request Filters with:</p><div class="language-csharp"><pre><code>GlobalRequestFiltersAsync<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>dto<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CheckRateLimit</span> <span class="token punctuation">{</span> 
        Service <span class="token operator">=</span> dto<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Name<span class="token punctuation">,</span>
        IpAddress <span class="token operator">=</span> req<span class="token punctuation">.</span>UserHostAddress<span class="token punctuation">,</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>RateLimitExceeded<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span>
         res<span class="token punctuation">.</span>StatusCode <span class="token operator">=</span> <span class="token number">403</span><span class="token punctuation">;</span>
         res<span class="token punctuation">.</span>StatusDescription <span class="token operator">=</span> <span class="token string">&quot;RateLimitExceeded&quot;</span><span class="token punctuation">;</span>
         res<span class="token punctuation">.</span><span class="token function">EndRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="enhanced-compression-options" tabindex="-1">Enhanced Compression Options <a class="header-anchor" href="#enhanced-compression-options" aria-hidden="true">#</a></h2><p>We&#39;ve followed up <a href="/releases/v4_5_6#clientserver-request-compression">Request Compression</a> added in the last release with more compression features in this release including:</p><h3 id="compressresponse-attribute" tabindex="-1"><code>[CompressResponse]</code> Attribute <a class="header-anchor" href="#compressresponse-attribute" aria-hidden="true">#</a></h3><p>You can now selectively choose which Services should be compressed with the new <code>[CompressResponse]</code> attribute to compress responses for clients which support compression, which can be applied to most Response Types, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CompressResponse</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompressedServices</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">CompressDto</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CompressExamplesResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">CompressString</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span> 
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">CompressBytes</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">.</span><span class="token function">ToUtf8Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">CompressStream</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MemoryStream</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">.</span><span class="token function">ToUtf8Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">CompressFile</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpResult</span><span class="token punctuation">(</span>VirtualFileSources<span class="token punctuation">.</span><span class="token function">GetFile</span><span class="token punctuation">(</span><span class="token string">&quot;/foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">CompressAnyHttpResult</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpResult</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CompressExamplesResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// DTO</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpResult</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// string</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpResult</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">.</span><span class="token function">ToUtf8Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bytes</span>
        <span class="token comment">//etc</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>Note using <code>[CompressResponse]</code> is unnecessary when returning <a href="/http-caching">cached responses</a> as ServiceStack automatically caches and returns the most optimal Response - typically compressed bytes for clients that supports compression</p></blockquote><h3 id="static-file-compression" tabindex="-1">Static File Compression <a class="header-anchor" href="#static-file-compression" aria-hidden="true">#</a></h3><p>ServiceStack can also be configured to compress static files with specific file extensions that are larger than specific size with the new opt-in Config options below:</p><div class="language-csharp"><pre><code><span class="token function">SetConfig</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">HostConfig</span> <span class="token punctuation">{</span>
    CompressFilesWithExtensions <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// (optional), only compress .js or .css files &gt; 10k</span>
    CompressFilesLargerThanBytes <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When more fine-grained logic is needed you can override <code>ShouldCompressFile()</code> in your AppHost to choose which static files you want to compress on a per-file basis, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">ShouldCompressFile</span><span class="token punctuation">(</span><span class="token class-name">IVirtualFile</span> file<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">ShouldCompressFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">||</span> file<span class="token punctuation">.</span>Name <span class="token operator">==</span> <span class="token string">&quot;large.csv&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="when-to-enable-static-file-compression" tabindex="-1">When to enable Static File Compression <a class="header-anchor" href="#when-to-enable-static-file-compression" aria-hidden="true">#</a></h4><p>It&#39;s more optimal to configure static file compression on the native Web Server that&#39;s hosting your ServiceStack App than in managed code. You can use <a href="http://www.telerik.com/fiddler" target="_blank" rel="noopener noreferrer">Fiddler</a> to check if your Web Server (e.g. IIS) is already compressing static files in which case you won&#39;t want to configure ServiceStack to do it.</p><p>No compression is added when running ServiceStack in a self-host, which will benefit from enabling Static File Compression.</p><h2 id="community" tabindex="-1">Community <a class="header-anchor" href="#community" aria-hidden="true">#</a></h2><p>We&#39;ve been lucky to receive a number of quality contributions from the Community in this release starting with the new <a href="https://serilog.net" target="_blank" rel="noopener noreferrer">Serilog</a> Logging provider contributed by <a href="https://github.com/englerj" target="_blank" rel="noopener noreferrer">Josh Engler</a>:</p><h3 id="servicestack-logging-serilog" tabindex="-1">ServiceStack.Logging.Serilog <a class="header-anchor" href="#servicestack-logging-serilog" aria-hidden="true">#</a></h3><p>To Configure Serilog Logging, first download <a href="https://www.nuget.org/packages/ServiceStack.Logging.Serilog" target="_blank" rel="noopener noreferrer">ServiceStack.Logging.Serilog</a> from NuGet:</p><pre><code>PM&gt; Install-Package ServiceStack.Logging.Serilog
</code></pre><p>Then configure ServiceStack to use <code>SerilogFactory</code>:</p><div class="language-csharp"><pre><code>LogManager<span class="token punctuation">.</span>LogFactory <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SerilogFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The Serilog adapter was then further <a href="https://github.com/ServiceStack/ServiceStack/commit/b9cb53168e37acc0a315d164f86a901b49449dc0" target="_blank" rel="noopener noreferrer">enhanced by Scott Mackay</a> who added Serilog-specific APIs:</p><div class="language-csharp"><pre><code>ILog<span class="token punctuation">.</span>Debug<span class="token return-type class-name"><span class="token punctuation">(</span>Exception ex<span class="token punctuation">,</span> <span class="token keyword">string</span> messageTemplate<span class="token punctuation">,</span> <span class="token keyword">params</span> <span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> propertyValues<span class="token punctuation">)</span></span>
ILog<span class="token punctuation">.</span>Info<span class="token return-type class-name"><span class="token punctuation">(</span>Exception ex<span class="token punctuation">,</span> <span class="token keyword">string</span> messageTemplate<span class="token punctuation">,</span> <span class="token keyword">params</span> <span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> propertyValues<span class="token punctuation">)</span></span>
ILog<span class="token punctuation">.</span>Warn<span class="token return-type class-name"><span class="token punctuation">(</span>Exception ex<span class="token punctuation">,</span> <span class="token keyword">string</span> messageTemplate<span class="token punctuation">,</span> <span class="token keyword">params</span> <span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> propertyValues<span class="token punctuation">)</span></span>
ILog<span class="token punctuation">.</span>Error<span class="token return-type class-name"><span class="token punctuation">(</span>Exception ex<span class="token punctuation">,</span> <span class="token keyword">string</span> messageTemplate<span class="token punctuation">,</span> <span class="token keyword">params</span> <span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> propertyValues<span class="token punctuation">)</span></span>
ILog<span class="token punctuation">.</span>Fatal<span class="token return-type class-name"><span class="token punctuation">(</span>Exception ex<span class="token punctuation">,</span> <span class="token keyword">string</span> messageTemplate<span class="token punctuation">,</span> <span class="token keyword">params</span> <span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> propertyValues<span class="token punctuation">)</span></span>
ILog<span class="token punctuation">.</span><span class="token function">ForContext</span><span class="token punctuation">(</span><span class="token class-name">Type</span> type<span class="token punctuation">)</span>
ILog<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ForContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ILog<span class="token punctuation">.</span><span class="token function">ForContext</span><span class="token punctuation">(</span><span class="token class-name">ILogEventEnricher</span> enricher<span class="token punctuation">)</span>
ILog<span class="token punctuation">.</span><span class="token function">ForContext</span><span class="token punctuation">(</span><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>ILogEventEnricher<span class="token punctuation">&gt;</span></span> enrichers<span class="token punctuation">)</span>
ILog<span class="token punctuation">.</span><span class="token function">ForContext</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> propertyName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> destructureObjects <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="community-projects" tabindex="-1">Community Projects <a class="header-anchor" href="#community-projects" aria-hidden="true">#</a></h2><p>There&#39;s also been a number of quality OSS Community projects that&#39;s surfaced recently that you may find useful to enable in your ServiceStack projects:</p><h3 id="servicestack-webhooks" tabindex="-1"><a href="https://github.com/jezzsantos/ServiceStack.Webhooks" target="_blank" rel="noopener noreferrer">ServiceStack.Webhooks</a> <a class="header-anchor" href="#servicestack-webhooks" aria-hidden="true">#</a></h3><p>If you need to implement a Webhooks solution for your Services you&#39;ll definitely want to check out <a href="https://github.com/jezzsantos/ServiceStack.Webhooks" target="_blank" rel="noopener noreferrer">ServiceStack.Webhooks</a> by <a href="https://github.com/jezzsantos" target="_blank" rel="noopener noreferrer">@jezzsantos</a>. ServiceStack.Webhooks is a high-quality, actively developed, <a href="https://github.com/jezzsantos/ServiceStack.Webhooks/wiki" target="_blank" rel="noopener noreferrer">well documented</a> solution for raising and managing application-level &quot;events&quot; raised by your services:</p><p><img src="https://raw.githubusercontent.com/jezzsantos/ServiceStack.Webhooks/master/docs/images/Webhooks.Architecture.PNG" alt=""></p><p>The ServiceStack.Webhooks plugin is extremely versatile and supports persisting event subscriptions in <a href="https://github.com/jezzsantos/ServiceStack.Webhooks/wiki/Plugins" target="_blank" rel="noopener noreferrer">multiple back-end data stores</a> including: Memory, Cache Clients, Azure Table Storage as well as every major <a href="/ormlite/installation">RDBMS that supported by OrmLite</a>.</p><h4 id="getting-started" tabindex="-1">Getting Started <a class="header-anchor" href="#getting-started" aria-hidden="true">#</a></h4><p>Install <a href="https://www.nuget.org/packages/ServiceStack.Webhooks" target="_blank" rel="noopener noreferrer">ServiceStack.Webhooks</a> from NuGet:</p><pre><code>PM&gt; Install-Package ServiceStack.Webhooks
</code></pre><p>Register the <code>WebhookFeature</code> plugin in your AppHost:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">Container</span> container<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Add ValidationFeature and AuthFeature plugins first</span>
    Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">WebhookFeature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then <a href="https://github.com/jezzsantos/ServiceStack.Webhooks/wiki/Getting-Started" target="_blank" rel="noopener noreferrer">configure the plugin</a> to suit your needs!</p><h3 id="servicestack-authentication-azure" tabindex="-1"><a href="https://github.com/ticky74/ServiceStack.Authentication.Azure" target="_blank" rel="noopener noreferrer">ServiceStack.Authentication.Azure</a> <a class="header-anchor" href="#servicestack-authentication-azure" aria-hidden="true">#</a></h3><p><a href="https://github.com/ticky74/ServiceStack.Authentication.Azure" target="_blank" rel="noopener noreferrer">ServiceStack.Authentication.Azure</a> is a fork of <a href="https://github.com/jfoshee/ServiceStack.Authentication.Aad" target="_blank" rel="noopener noreferrer">ServiceStack.Authentication.Aad</a> developed by <a href="https://github.com/ticky74" target="_blank" rel="noopener noreferrer">Ian Kulmatycki</a> which provides an <code>AzureAuthenticationProvider</code> for easily authenticating users with Office365 and hybrid Azure Active Directories.</p><h4 id="getting-started-1" tabindex="-1">Getting Started <a class="header-anchor" href="#getting-started-1" aria-hidden="true">#</a></h4><p>Install <a href="https://www.nuget.org/packages/ServiceStack.Authentication.Azure" target="_blank" rel="noopener noreferrer">ServiceStack.Authentication.Azure</a> from NuGet:</p><pre><code>PM&gt; Install-Package ServiceStack.Authentication.Azure
</code></pre><p>Register the <code>AzureAuthenticationProvider</code> in ServiceStack&#39;s <code>AuthFeature</code>:</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthFeature</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthUserSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IAuthProvider<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AzureAuthenticationProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Follow the Instructions for <a href="https://github.com/ticky74/ServiceStack.Authentication.Azure#configuring-azure" target="_blank" rel="noopener noreferrer">registering your App</a> with Microsoft.</p><p>Then Configure the provider with your App details to get a working Azure Auth Provider!</p><div class="language-csharp"><pre><code>container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Register</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IApplicationRegistryService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> <span class="token function">SingleTenantApplicationRegistryService</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AzureDirectorySettings</span>
    <span class="token punctuation">{</span>
        ClientId <span class="token operator">=</span> <span class="token string">&quot;&lt;ApplicationId From App Registration Page&gt;&quot;</span><span class="token punctuation">,</span>
        ClientSecret <span class="token operator">=</span> <span class="token string">&quot;&lt;Super secret password generated on App Reg. Page&gt;&quot;</span><span class="token punctuation">,</span>
        DirectoryName <span class="token operator">=</span> <span class="token string">&quot;&lt;Azure directory name i.e. contoso.com&gt;&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="servicestack-authentication-marten" tabindex="-1"><a href="https://github.com/migajek/ServiceStack.Authentication.Marten" target="_blank" rel="noopener noreferrer">ServiceStack.Authentication.Marten</a> <a class="header-anchor" href="#servicestack-authentication-marten" aria-hidden="true">#</a></h3><p><a href="https://github.com/migajek/ServiceStack.Authentication.Marten" target="_blank" rel="noopener noreferrer">ServiceStack.Authentication.Marten</a> is a <code>UserAuthRepository</code> repository developed by <a href="https://github.com/migajek" target="_blank" rel="noopener noreferrer">Micha\u0142 Gajek</a> for persisting users in <a href="http://jasperfx.github.io/marten/getting_started/" target="_blank" rel="noopener noreferrer">Marten</a> - a Document Database for PostgreSQL.</p><h4 id="getting-started-2" tabindex="-1">Getting Started <a class="header-anchor" href="#getting-started-2" aria-hidden="true">#</a></h4><p>Install <a href="https://www.nuget.org/packages/ServiceStack.Authentication.Marten" target="_blank" rel="noopener noreferrer">ServiceStack.Authentication.Marten</a> from NuGet:</p><pre><code>PM&gt; Install-Package ServiceStack.Authentication.Marten
</code></pre><p>When configuring Marten, use the <code>AuthRepository()</code> extension method to configure the storage for both <code>UserAuth</code> and <code>UserAuthDetails</code> types:</p><div class="language-csharp"><pre><code>DocumentStore<span class="token punctuation">.</span><span class="token function">For</span><span class="token punctuation">(</span>opts <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      
    opts<span class="token punctuation">.</span><span class="token function">AuthRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">UseAuth</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserAuth<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">UseAuthDetails</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserAuthDetails<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Then register the auth repository in the Container:</p><div class="language-csharp"><pre><code>container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Register</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IUserAuthRepository<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MartenAuthRepository</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDocumentStore<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="multiappsettingsbuilder" tabindex="-1">MultiAppSettingsBuilder <a class="header-anchor" href="#multiappsettingsbuilder" aria-hidden="true">#</a></h3><p>Another feature contributed by <a href="https://github.com/englerj" target="_blank" rel="noopener noreferrer">Josh Engler</a> is the <code>MultiAppSettingsBuilder</code> which adds a fluent discoverable API for configuring ServiceStack&#39;s various <a href="/appsettings">App Setting Providers</a>, e.g:</p><div class="language-csharp"><pre><code>AppSettings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MultiAppSettingsBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddAppSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddDictionarySettings</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span> <span class="token string">&quot;override&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;setting&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddEnvironmentalVariables</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddTextFile</span><span class="token punctuation">(</span><span class="token string">&quot;~/path/to/settings.txt&quot;</span><span class="token punctuation">.</span><span class="token function">MapProjectPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="cacheclient-with-prefix" tabindex="-1">CacheClient with Prefix <a class="header-anchor" href="#cacheclient-with-prefix" aria-hidden="true">#</a></h3><p>The <code>CacheClientWithPrefix</code> class contributed by <a href="https://github.com/joelharkes" target="_blank" rel="noopener noreferrer">@joelharkes</a> lets you decorate any <code>ICacheClient</code> to prefix all cache keys using the <code>.WithPrefix()</code> extension method. This could be used to easily enable multi-tenant usage of a single redis instance, e.g:</p><div class="language-csharp"><pre><code>container<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> 
    c<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IRedisClientsManager<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetCacheClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WithPrefix</span><span class="token punctuation">(</span><span class="token string">&quot;site1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="ormlite" tabindex="-1">OrmLite <a class="header-anchor" href="#ormlite" aria-hidden="true">#</a></h2><h3 id="ormlite-soft-deletes" tabindex="-1">OrmLite Soft Deletes <a class="header-anchor" href="#ormlite-soft-deletes" aria-hidden="true">#</a></h3><p>Select Filters were added to OrmLite to let you specify a custom <code>SelectFilter</code> that lets you modify queries that use <code>SqlExpression&lt;T&gt;</code> before they&#39;re executed. This could be used to make working with &quot;Soft Deletes&quot; Tables easier where it can be made to apply a custom <code>x.IsDeleted != true</code> condition on every <code>SqlExpression</code>.</p><p>By either using a <code>SelectFilter</code> on concrete POCO Table Types, e.g:</p><div class="language-csharp"><pre><code>SqlExpression<span class="token operator">&lt;</span>Table1<span class="token operator">&gt;</span><span class="token punctuation">.</span>SelectFilter <span class="token operator">=</span> q <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>IsDeleted <span class="token operator">!=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
SqlExpression<span class="token operator">&lt;</span>Table2<span class="token operator">&gt;</span><span class="token punctuation">.</span>SelectFilter <span class="token operator">=</span> q <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>IsDeleted <span class="token operator">!=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or alternatively using generic delegate that applies to all SqlExpressions, but you&#39;ll only have access to a <code>IUntypedSqlExpression</code> which offers a limited API surface area but will still let you execute a custom filter for all <code>SqlExpression&lt;T&gt;</code> that could be used to add a condition for all tables implementing a custom <code>ISoftDelete</code> interface with:</p><div class="language-csharp"><pre><code>OrmLiteConfig<span class="token punctuation">.</span>SqlExpressionSelectFilter <span class="token operator">=</span> q <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>q<span class="token punctuation">.</span>ModelDef<span class="token punctuation">.</span>ModelType<span class="token punctuation">.</span><span class="token function">HasInterface</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">ISoftDelete</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        q<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Where</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ISoftDelete<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>IsDeleted <span class="token operator">!=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Both solutions above will transparently add the <code>x.IsDeleted != true</code> to all <code>SqlExpression&lt;T&gt;</code> based queries so it only returns results which aren&#39;t <code>IsDeleted</code> from any of queries below:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> results <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">From</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Table<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Single</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">From</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Table<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Name <span class="token operator">==</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Single</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Name <span class="token operator">==</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="check-constraints" tabindex="-1">Check Constraints <a class="header-anchor" href="#check-constraints" aria-hidden="true">#</a></h3><p>OrmLite has added support for <a href="https://en.wikipedia.org/wiki/Check_constraint" target="_blank" rel="noopener noreferrer">SQL Check Constraints</a> which will create your Table schema with the <code>[CheckConstraint]</code> specified, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Table</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoIncrement</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CheckConstraint</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Age &gt; 1&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CheckConstraint</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Name IS NOT NULL&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">DropAndCreateTable</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Table<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="servicestack-text" tabindex="-1">ServiceStack.Text <a class="header-anchor" href="#servicestack-text" aria-hidden="true">#</a></h2><p>You can easily escape HTML Entities characters (<code>&lt;</code>, <code>&gt;</code>, <code>&amp;</code>, <code>=</code>, <code>&#39;</code>) when serializing JSON strings with:</p><div class="language-csharp"><pre><code>JsConfig<span class="token punctuation">.</span>EscapeHtmlChars <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><p>This can also be requested by clients using <a href="/customize-json-responses">Customized JSON Responses</a>, e.g:</p><pre><code>/my-api?jsconfig=EscapeHtmlChars
</code></pre><h2 id="rabbit-mq" tabindex="-1">Rabbit MQ <a class="header-anchor" href="#rabbit-mq" aria-hidden="true">#</a></h2><p>A strong-named version of ServiceStack.RabbitMq is now available at:</p><pre><code>PM&gt; Install-Package ServiceStack.RabbitMq.Signed
</code></pre><p>The new <code>CreateQueueFilter</code> and <code>CreateTopicFilter</code> filters added to the <a href="/rabbit-mq">Rabbit MQ Server</a> will let you customize what options Rabbit MQ Queue&#39;s and topics are created with. The filters can be used to <a href="https://www.rabbitmq.com/ttl.html" target="_blank" rel="noopener noreferrer">declare a queue with a custom TTL</a> and have messages automatically expire after 60 seconds with:</p><div class="language-csharp"><pre><code>container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Register</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IMessageService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RabbitMqServer</span><span class="token punctuation">(</span>ConnectionString<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    CreateQueueFilter <span class="token operator">=</span> <span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>queueName <span class="token operator">==</span> QueueNames<span class="token operator">&lt;</span>MyRequest<span class="token operator">&gt;</span><span class="token punctuation">.</span>In<span class="token punctuation">)</span>
            args<span class="token punctuation">[</span><span class="token string">&quot;x-message-ttl&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">60000</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="startup-errors" tabindex="-1">Startup Errors <a class="header-anchor" href="#startup-errors" aria-hidden="true">#</a></h2><p>When plugins are registered their Exceptions are swallowed and captured in <code>AppHost.StartupErrors</code> so an individual Rogue plugin won&#39;t prevent your ServiceStack AppHost from starting. But when a plugin doesn&#39;t work properly it can be hard to determine the cause was due to an Exception occuring at Startup. To better highlight the presence of Startup Errors we&#39;re now adding a red warning banner in <code>/metadata</code> pages when in <a href="/debugging#debugmode">DebugMode</a>, e.g:</p><p><img src="`+r+`" alt=""></p><p>The number of Startup Errors is also added to the <code>X-Startup-Errors: n</code> Global HTTP Header so you&#39;ll be able to notice it when debugging HTTP Traffic.</p><p>If you prefer that any Plugin Exception is immediately visible you can register this callback in your <code>AppHost</code> to throw a YSOD with your first Startup Error:</p><div class="language-csharp"><pre><code>AfterInitCallbacks<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>host <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> appHost <span class="token operator">=</span> <span class="token punctuation">(</span>ServiceStackHost<span class="token punctuation">)</span>host<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>appHost<span class="token punctuation">.</span>StartUpErrors<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span>appHost<span class="token punctuation">.</span>StartUpErrors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="forcing-a-content-type" tabindex="-1">Forcing a Content Type <a class="header-anchor" href="#forcing-a-content-type" aria-hidden="true">#</a></h3><p>Whilst ServiceStack Services are typically available on any endpoint and format, there are times when you only want adhoc Services available in a particular format, for instance you may only want the View Models for your dynamic Web Views available in HTML. This can now be easily enabled with the new <code>[HtmlOnly]</code> Request Filter Attribute, e.g:</p><div class="language-cshtml"><pre><code>[HtmlOnly]
public class HtmlServices : Service
{
    public object Any(MyRequest request) =&gt; new MyViewModel { .. };
}
</code></pre></div><p>This feature is also available for other built-in Content Types: <code>[JsonOnly]</code>, <code>[XmlOnly]</code>, <code>[JsvOnly]</code> and <code>[CsvOnly]</code>.</p><h2 id="minor-authentication-features" tabindex="-1">Minor Authentication Features <a class="header-anchor" href="#minor-authentication-features" aria-hidden="true">#</a></h2><h3 id="authfiltercontext" tabindex="-1">AuthFilterContext <a class="header-anchor" href="#authfiltercontext" aria-hidden="true">#</a></h3><p>Auth Providers can customize the <code>AuthenticateResponse</code> returned by implementing <code>IAuthResponseFilter</code> where it will get called back with a populated <a href="https://github.com/ServiceStack/ServiceStack/blob/dfefd50b6ab5f03fce4f6dbbf445ec08150e0cba/src/ServiceStack/Auth/IAuthProvider.cs#L51" target="_blank" rel="noopener noreferrer">AuthFilterContext</a>:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthFilterContext</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> AuthenticateService AuthService    <span class="token comment">// Instance of AuthenticateService</span>
    <span class="token keyword">public</span> IAuthProvider AuthProvider         <span class="token comment">// Selected Auth Provider for Request</span>
    <span class="token keyword">public</span> IAuthSession Session               <span class="token comment">// Users Session</span>
    <span class="token keyword">public</span> Authenticate AuthRequest           <span class="token comment">// Auth Request DTO</span>
    <span class="token keyword">public</span> AuthenticateResponse AuthResponse  <span class="token comment">// Auth Response DTO</span>
    <span class="token keyword">public</span> <span class="token keyword">bool</span> AlreadyAuthenticated          <span class="token comment">// User was already authenticated</span>
    <span class="token keyword">public</span> <span class="token keyword">bool</span> DidAuthenticate               <span class="token comment">// User Authenticated in this request</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The filters can be used to modify properties on the <code>AuthenticateResponse</code> DTO or to completely replace what <code>AuthenticateResponse</code> is returned, specify a <code>AuthFeature.AuthResponseDecorator</code>.</p><h3 id="icustomuserauth" tabindex="-1">ICustomUserAuth <a class="header-anchor" href="#icustomuserauth" aria-hidden="true">#</a></h3><p>The <code>ICustomUserAuth</code> interface can be implemented on User Auth Repositories that allow replacing the custom <code>UserAuth</code> and <code>UserAuthDetails</code> tables by returning the concrete Type that should be used instead:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ICustomUserAuth</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name">IUserAuth</span> <span class="token function">CreateUserAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token return-type class-name">IUserAuthDetails</span> <span class="token function">CreateUserAuthDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This allows using the same <code>RegistrationFeature</code> and <code>RegisterService</code> to handle registering new users with the substituted <code>IUserAuth</code> and <code>IUserAuthDetails</code> Types.</p><h3 id="authprovider-available-on-iauthsession" tabindex="-1">AuthProvider available on IAuthSession <a class="header-anchor" href="#authprovider-available-on-iauthsession" aria-hidden="true">#</a></h3><p>You can now determine what Auth Provider was used to populate a User&#39;s Session with the new <code>IAuthSession.AuthProvider</code> property. This could be used for instance to detect and ensure highly-sensitive services are only available to users that authenticated using a specific Auth Provider.</p><h3 id="customizable-populateuserroles-on-aspnetwindowsauthprovider" tabindex="-1">Customizable PopulateUserRoles on AspNetWindowsAuthProvider <a class="header-anchor" href="#customizable-populateuserroles-on-aspnetwindowsauthprovider" aria-hidden="true">#</a></h3><p>The <code>AspNetWindowsAuthProvider</code> uses the public <code>IPrincipal.IsInRole()</code> API to determine if a User is in a particular Windows Auth role, however this can be slow when needing to query a large number of roles in LDAP as it would need to make an LDAP lookup for each role.</p><p>Performance of this can now be improved by specifying a custom <code>PopulateUserRoles</code> implementation that overrides how User Roles are resolved, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AspNetWindowsAuthProvider</span> <span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    PopulateUserRoles <span class="token operator">=</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> user<span class="token punctuation">,</span> session<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">WindowsIdentity</span> userId <span class="token operator">=</span> request<span class="token punctuation">?.</span>LogonUserIdentity<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">List</span> roles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>userId<span class="token punctuation">?.</span>Groups <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> <span class="token keyword">group</span> <span class="token keyword">in</span> userId<span class="token punctuation">.</span>Groups<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token comment">// Remove the domain name from the name of the group, </span>
                    <span class="token comment">// if it has it, and you don&#39;t need it. </span>
                    <span class="token class-name"><span class="token keyword">var</span></span> groupName <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SecurityIdentifier</span><span class="token punctuation">(</span><span class="token keyword">group</span><span class="token punctuation">.</span>Value<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">Translate</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">NTAccount</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>groupName<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>&quot;\\&quot;<span class="token punctuation">)</span><span class="token punctuation">)</span> 
                    groupName <span class="token operator">=</span> groupName<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>&#39;\\&#39;<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
                    roles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>groupName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            session<span class="token punctuation">.</span>Roles <span class="token operator">=</span> roles<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="all-net-core-examples-upgraded-to-net-core-1-1" tabindex="-1">All .NET Core Examples upgraded to .NET Core 1.1 <a class="header-anchor" href="#all-net-core-examples-upgraded-to-net-core-1-1" aria-hidden="true">#</a></h2><p>All .NET Core Live examples including the <strong>redis-geo</strong> project used in <a href="/deploy-netcore-docker-aws-ecs">Deploy .NET Core with Docker to AWS ECS Guide</a> were upgraded to .NET Core 1.1 and has been changed to use the <code>microsoft/dotnet:1.1-sdk-projectjson</code> Docker Image since <code>microsoft/dotnet:latest</code> was changed to only support projects with VS 2017 <code>.csproj</code> msbuild format.</p><h2 id="other-changes" tabindex="-1">Other Changes <a class="header-anchor" href="#other-changes" aria-hidden="true">#</a></h2><ul><li><code>SessionFeature.SessionBagExpiry</code> can be used to specify expiry on SessionBag items</li><li>Additional <code>StatusCode</code>, <code>StatusDescription</code>, <code>ExceptionSource</code> and <code>ExceptionData</code> were added on <code>RequestLogEntry</code></li><li><code>OnEndRequestCallbacks</code> added to <code>IAppHost</code></li></ul><h1 id="v4-5-6-release-notes" tabindex="-1"><a href="/releases/v4_5_6">v4.5.6 Release Notes</a> <a class="header-anchor" href="#v4-5-6-release-notes" aria-hidden="true">#</a></h1>`,368),v=[g];function m(f,b,y,w,S,A){return k(),u("div",null,v)}var R=l(h,[["render",m]]);export{x as __pageData,R as default};
